<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# OPTIONS_HADDOCK prune, ignore-exports #-}</span><span>
</span><a name="line-2"></a><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
Module      : ToLLVM
Description : Module to convert the HashedExpression to LLVM intermediate representation
Copyright   : (c) Padma Pasupathi, 2020
Licence     : BSD Licence 2.0                  
Maintainer  : pasupatp@mcmaster.ca
Stability   : experimental
Portability : POSIX

This module has the following functions,
 __/LLVMMemMap/__ - is used to allocate memory for all nodes

 __/GenerateEvaluatingCodes/__ - is used to generate LLVM Definition for every operation

__/mkModule/__ - is used to bind all generated LLVM Definitions to a single LLVM module

 __/Externals/__ - is used to declare all inbuilt functions in LLVM and other helper functions for the above functions.

 The two main functions for generating the LLVM IR evaluation functions from an Expression are makeMemoryMap and generateEvaluatingCode.

 The makeLLVMMemoryMap function allocates memory for all subexpressions. Expression is a DAG (Directed Acyclic Graph) of subexpressions which is stored in a hash map. Every node contains an operation, references to inputs and its dimensions, and whether it is real or complex. The makeLLVMMemoryMap function gets the list of nodes, calculates its size based on the shape obtained from the Expression map and lays them out linearly. This is implemented with a fold operation. The value accumulated by the fold is a pair of the total size and an IntMap mapping the node id to the offset in the allocated memory.

 The generateEvaluatingCode function is used to generate the evaluation function for the given expression.  The code is generated one subexpression at a time.

 Since the subexpression is a DAG, there is an ordering of the nodes in which inputs occur before subexpressions which use them.  Say for instance, in the expression 2x + 2y, the subexpressions can be calculated in the order 2x,2y,2x + 2y, but 2x + 2y could not calculated before 2*y, because it needs it as an input.  This type of order is called a topological order, and is implemented in topologicalSortManyRoots.  Many roots means that it can be used to evaluate multiple expressions with shared subexpressions.

 Code generation is implemented by taking the sorting keys and mapping an evaluation function over the list of keys.  The evaluation function matches the operation to LLVM IR instructions.

 __NOTE__: The test suite for this module is available at test/TestToLLVM/ directory. Please go through the README.md file in this directory for running the test cases.

-}</span><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HashedExpression.Internal.ToLLVM</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">(</span><span>     </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMap"><span class="hs-identifier hs-type">LLVMMemMap</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMapEntry"><span class="hs-identifier hs-type">LLVMMemMapEntry</span></a><span>
</span><a name="line-38"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#Code"><span class="hs-identifier hs-type">Code</span></a><span>
</span><a name="line-39"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#makeLLVMMemMap"><span class="hs-identifier hs-var">makeLLVMMemMap</span></a><span>
</span><a name="line-40"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a><span>
</span><a name="line-41"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#generateEvaluatingCodes"><span class="hs-identifier hs-var">generateEvaluatingCodes</span></a><span>
</span><a name="line-42"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#mmUpdate"><span class="hs-identifier hs-var">mmUpdate</span></a><span>
</span><a name="line-43"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#externals"><span class="hs-identifier hs-var">externals</span></a><span>
</span><a name="line-44"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span>
</span><a name="line-45"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#funcType"><span class="hs-identifier hs-var">funcType</span></a><span>
</span><a name="line-46"></a><span>      </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#nameDef"><span class="hs-identifier hs-var">nameDef</span></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Array</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Graph</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">buildG</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">topSort</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IntMap.Strict</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sort</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">map</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intersperse</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">tails</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.HT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">splitLast</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">insert</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">member</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Debug.Trace</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">traceShowId</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><a href="FFTW.html"><span class="hs-identifier">FFTW</span></a><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Stack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">HasCallStack</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Expression.html"><span class="hs-identifier">HashedExpression.Internal.Expression</span></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="HashedExpression.Internal.Expression.html#DimensionType"><span class="hs-identifier hs-type">DimensionType</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#ET"><span class="hs-identifier hs-type">ET</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-type">Expression</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#ExpressionMap"><span class="hs-identifier hs-type">ExpressionMap</span></a><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Node"><span class="hs-identifier hs-type">Node</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#NumType"><span class="hs-identifier hs-type">NumType</span></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Hash.html"><span class="hs-identifier">HashedExpression.Internal.Hash</span></a><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Inner.html"><span class="hs-identifier">HashedExpression.Internal.Inner</span></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Node.html"><span class="hs-identifier">HashedExpression.Internal.Node</span></a><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Utils.html"><span class="hs-identifier">HashedExpression.Internal.Utils</span></a><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Prettify.html"><span class="hs-identifier">HashedExpression.Prettify</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Prettify.html#prettifyDebug"><span class="hs-identifier hs-var">prettifyDebug</span></a><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.AST</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Mul</span><span class="hs-special">,</span><span class="hs-identifier hs-type">FMul</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">LLVM.AST</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">AST</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.AST.Type</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.AST.Global</span><span>
</span><a name="line-80"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.Context</span><span>
</span><a name="line-81"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.Module</span><span>
</span><a name="line-82"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">LLVM.AST.Constant</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">C</span><span>
</span><a name="line-83"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Except</span><span>
</span><a name="line-84"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Char8</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BS</span><span>
</span><a name="line-85"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.AST.Float</span><span>
</span><a name="line-86"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">LLVM.AST.CallingConvention</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">CC</span><span>
</span><a name="line-87"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">LLVM.AST.ParameterAttribute</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">PA</span><span>
</span><a name="line-88"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">LLVM.AST.FunctionAttribute</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">FA</span><span>
</span><a name="line-89"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">LLVM.AST.Linkage</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- | offset/key into the allocated memory</span><span>
</span><a name="line-92"></a><span class="hs-identifier">offsetType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">AST.Type</span><span>
</span><a name="line-93"></a><a name="offsetType"><a href="HashedExpression.Internal.ToLLVM.html#offsetType"><span class="hs-identifier">offsetType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.IntegerType</span><span> </span><span class="hs-number">64</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-comment">-- | all elements used here are of double type</span><span>
</span><a name="line-96"></a><span class="hs-identifier">elemType</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">AST.Type</span><span>
</span><a name="line-97"></a><a name="elemType"><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier">elemType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">AST.FloatingPointType</span><span> </span><span class="hs-identifier hs-var">AST.DoubleFP</span><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">-- | Every node entry in the memory has an Index, Type of entry which can be either Real or Complex and its dimension</span><span>
</span><a name="line-100"></a><span class="hs-keyword">type</span><span> </span><a name="LLVMMemMapEntry"><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMapEntry"><span class="hs-identifier">LLVMMemMapEntry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span>       </span><span class="hs-comment">--  Node index</span><span>
</span><a name="line-101"></a><span>                        </span><a href="HashedExpression.Internal.ToLLVM.html#EntryType"><span class="hs-identifier hs-type">EntryType</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">--  Type of node (Real or complex),</span><span>
</span><a name="line-102"></a><span>                        </span><a href="HashedExpression.Internal.Expression.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span class="hs-special">)</span><span>     </span><span class="hs-comment">--  Dimension of the node (0 -[]: Scalar 1D - [n]: Array, 2D - [n,m]: Matrix . . . )</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | EntryType Defines the type of node entry in the memory which can either be Real or Complex</span><span>
</span><a name="line-105"></a><span class="hs-keyword">data</span><span> </span><a name="EntryType"><a href="HashedExpression.Internal.ToLLVM.html#EntryType"><span class="hs-identifier">EntryType</span></a></a><span>
</span><a name="line-106"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="EntryR"><a href="HashedExpression.Internal.ToLLVM.html#EntryR"><span class="hs-identifier">EntryR</span></a></a><span> </span><span class="hs-comment">-- ^ node of type Real number</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="EntryC"><a href="HashedExpression.Internal.ToLLVM.html#EntryC"><span class="hs-identifier">EntryC</span></a></a><span> </span><span class="hs-comment">-- ^ node of type Complex number</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">-- | LLVM Code is a list of Named instructions like Add, FAdd, Mul, Call etc.</span><span>
</span><a name="line-111"></a><span class="hs-keyword">type</span><span> </span><a name="Code"><a href="HashedExpression.Internal.ToLLVM.html#Code"><span class="hs-identifier">Code</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Named</span><span> </span><span class="hs-identifier hs-type">AST.Instruction</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ List of LLVM instructions forming final code</span><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-comment">-- | LLVMMemMap has the every node with an index</span><span>
</span><a name="line-114"></a><span class="hs-keyword">data</span><span> </span><a name="LLVMMemMap"><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMap"><span class="hs-identifier">LLVMMemMap</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-115"></a><span>    </span><a name="LLVMMemMap"><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMap"><span class="hs-identifier">LLVMMemMap</span></a></a><span>
</span><a name="line-116"></a><span>        </span><span class="hs-special">{</span><span> </span><a name="entryMap"><a href="HashedExpression.Internal.ToLLVM.html#entryMap"><span class="hs-identifier">entryMap</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMapEntry"><span class="hs-identifier hs-type">LLVMMemMapEntry</span></a><span> </span><span class="hs-comment">-- ^ every node entry with its index.</span><span>
</span><a name="line-117"></a><span>        </span><span class="hs-special">,</span><span> </span><a name="totalDoubles"><a href="HashedExpression.Internal.ToLLVM.html#totalDoubles"><span class="hs-identifier">totalDoubles</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Total number of entries</span><span>
</span><a name="line-118"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- |  __makeLLVMMemMap__ takes any expression map and converts it to corresponding LLVM memory map</span><span>
</span><a name="line-122"></a><span class="hs-identifier">makeLLVMMemMap</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Expression.html#ExpressionMap"><span class="hs-identifier hs-type">ExpressionMap</span></a><span> </span><span class="hs-comment">-- ^ Expression with its dimension/shape</span><span>
</span><a name="line-123"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMap"><span class="hs-identifier hs-type">LLVMMemMap</span></a><span> </span><span class="hs-comment">-- ^ node entry in memory</span><span>
</span><a name="line-124"></a><a name="makeLLVMMemMap"><a href="HashedExpression.Internal.ToLLVM.html#makeLLVMMemMap"><span class="hs-identifier">makeLLVMMemMap</span></a></a><span> </span><a name="local-6989586621679346179"><a href="#local-6989586621679346179"><span class="hs-identifier">exprMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMap"><span class="hs-identifier hs-var">LLVMMemMap</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.ToLLVM.html#mmUpdate"><span class="hs-identifier hs-var">mmUpdate</span></a><span> </span><a href="#local-6989586621679346179"><span class="hs-identifier hs-var">exprMap</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">IM.empty</span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679346180"><span class="hs-identifier hs-var">nkeys</span></a><span>
</span><a name="line-125"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-126"></a><span>    </span><a name="local-6989586621679346180"><a href="#local-6989586621679346180"><span class="hs-identifier">nkeys</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM.keys</span><span> </span><a href="#local-6989586621679346179"><span class="hs-identifier hs-var">exprMap</span></a><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-comment">-- | mmUpdate is a helper function for |makeLLVMMemMap|</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-identifier">mmUpdate</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-131"></a><span>       </span><a href="HashedExpression.Internal.Expression.html#ExpressionMap"><span class="hs-identifier hs-type">ExpressionMap</span></a><span> </span><span class="hs-comment">-- ^ Expression mapped with its dimension</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMapEntry"><span class="hs-identifier hs-type">LLVMMemMapEntry</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ current memory and its size</span><span>
</span><a name="line-133"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ node id</span><span>
</span><a name="line-134"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IntMap</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMapEntry"><span class="hs-identifier hs-type">LLVMMemMapEntry</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ updated memory and updated size</span><span>
</span><a name="line-135"></a><a name="mmUpdate"><a href="HashedExpression.Internal.ToLLVM.html#mmUpdate"><span class="hs-identifier">mmUpdate</span></a></a><span> </span><a name="local-6989586621679346181"><a href="#local-6989586621679346181"><span class="hs-identifier">exprMap</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346182"><a href="#local-6989586621679346182"><span class="hs-identifier">memMapSoFar</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346183"><a href="#local-6989586621679346183"><span class="hs-identifier">sizeSoFar</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679346184"><a href="#local-6989586621679346184"><span class="hs-identifier">nId</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679346185"><a href="#local-6989586621679346185"><span class="hs-identifier">shape</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346186"><a href="#local-6989586621679346186"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveInternal"><span class="hs-identifier hs-var">retrieveInternal</span></a><span> </span><a href="#local-6989586621679346184"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679346181"><span class="hs-identifier hs-var">exprMap</span></a><span>
</span><a name="line-137"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679346187"><a href="#local-6989586621679346187"><span class="hs-identifier">nodeSz</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346188"><a href="#local-6989586621679346188"><span class="hs-identifier">mmShape</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Node.html#nodeElementType"><span class="hs-identifier hs-var">nodeElementType</span></a><span> </span><a href="#local-6989586621679346186"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679346181"><span class="hs-identifier hs-var">exprMap</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">product</span><span> </span><a href="#local-6989586621679346185"><span class="hs-identifier hs-var">shape</span></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#EntryR"><span class="hs-identifier hs-var">EntryR</span></a><span class="hs-special">)</span><span>
</span><a name="line-139"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Node.html#nodeElementType"><span class="hs-identifier hs-var">nodeElementType</span></a><span> </span><a href="#local-6989586621679346186"><span class="hs-identifier hs-var">node</span></a><span> </span><a href="#local-6989586621679346181"><span class="hs-identifier hs-var">exprMap</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="HashedExpression.Internal.Expression.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-identifier hs-var">product</span><span> </span><a href="#local-6989586621679346185"><span class="hs-identifier hs-var">shape</span></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#EntryC"><span class="hs-identifier hs-var">EntryC</span></a><span class="hs-special">)</span><span>
</span><a name="line-140"></a><span>        </span><a name="local-6989586621679346189"><a href="#local-6989586621679346189"><span class="hs-identifier">newMemMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">IM.insert</span><span> </span><a href="#local-6989586621679346184"><span class="hs-identifier hs-var">nId</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346183"><span class="hs-identifier hs-var">sizeSoFar</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346188"><span class="hs-identifier hs-var">mmShape</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346185"><span class="hs-identifier hs-var">shape</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679346182"><span class="hs-identifier hs-var">memMapSoFar</span></a><span>
</span><a name="line-141"></a><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346189"><span class="hs-identifier hs-var">newMemMap</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346183"><span class="hs-identifier hs-var">sizeSoFar</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="#local-6989586621679346187"><span class="hs-identifier hs-var">nodeSz</span></a><span class="hs-special">)</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-comment">-- | Generate evaluation code (usually an expression and its partial derivatives) given an ExpressionMap and indices of nodes to be computed</span><span>
</span><a name="line-144"></a><span class="hs-comment">--</span><span>
</span><a name="line-145"></a><span class="hs-identifier">generateEvaluatingCodes</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Name of the function to be generated in LLVM</span><span>
</span><a name="line-146"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#LLVMMemMap"><span class="hs-identifier hs-type">LLVMMemMap</span></a><span> </span><span class="hs-comment">-- ^ mapped node from memory</span><span>
</span><a name="line-147"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#ExpressionMap"><span class="hs-identifier hs-type">ExpressionMap</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^ expression map and its indices</span><span>
</span><a name="line-148"></a><span>                           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Definition</span><span> </span><span class="hs-comment">-- ^ LLVM definition for the given expression</span><span>
</span><a name="line-149"></a><a name="generateEvaluatingCodes"><a href="HashedExpression.Internal.ToLLVM.html#generateEvaluatingCodes"><span class="hs-identifier">generateEvaluatingCodes</span></a></a><span> </span><a name="local-6989586621679346190"><a href="#local-6989586621679346190"><span class="hs-identifier">funcName</span></a></a><span> </span><a name="local-6989586621679346191"><a href="#local-6989586621679346191"><span class="hs-identifier">memMap</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346192"><a href="#local-6989586621679346192"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346193"><a href="#local-6989586621679346193"><span class="hs-identifier">rootIds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-151"></a><span>    </span><a name="local-6989586621679346194"><a href="#local-6989586621679346194"><span class="hs-identifier">sortedVars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">sort</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Inner.html#varNodesWithId"><span class="hs-identifier hs-var">varNodesWithId</span></a><span> </span><a href="#local-6989586621679346192"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-comment">--  Sorts variable names given in the expression</span><span>
</span><a name="line-152"></a><span>    </span><a name="local-6989586621679346195"><a href="#local-6989586621679346195"><span class="hs-identifier">parameterMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679346194"><span class="hs-identifier hs-var">sortedVars</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--  Maps all sorted parameters/ variables with a index number</span><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span>    </span><span class="hs-comment">-- | create a temporary variable out of the node id</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-comment">-- | mkTemp :: Int -&gt; AST.Name</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-identifier">mkTemp</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>        </span><span class="hs-comment">-- ^ Takes an integer (index of the node) as input</span><span>
</span><a name="line-157"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Name</span><span> </span><span class="hs-comment">-- ^ returns a variable name of &quot;Name&quot; Type in LLVM</span><span>
</span><a name="line-158"></a><span>    </span><a name="local-6989586621679346196"><a href="#local-6989586621679346196"><span class="hs-identifier">mkTemp</span></a></a><span> </span><a name="local-6989586621679346203"><a href="#local-6989586621679346203"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-159"></a><span>      </span><span class="hs-keyword">case</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveInternal"><span class="hs-identifier hs-var">retrieveInternal</span></a><span> </span><a href="#local-6989586621679346203"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346192"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-160"></a><span>        </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="HashedExpression.Internal.Expression.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621679346204"><a href="#local-6989586621679346204"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679346204"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679346195"><span class="hs-identifier hs-var">parameterMap</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-161"></a><span>                            </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679346205"><a href="#local-6989586621679346205"><span class="hs-identifier">idx</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346204"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">--  If the node is a variable, its name is used as the LLVM variable</span><span>
</span><a name="line-162"></a><span>                            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;variable name missing from parameterMap&quot;</span><span>
</span><a name="line-163"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;t&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679346203"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">--  if the node is anything other than Var type, temporary variable name is generated.</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>    </span><span class="hs-comment">-- | mkTemp2 is for generating temporary variable names when there are more than 2 variables in an addition or multiplication operation</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-identifier">mkTemp2</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span>  </span><span class="hs-comment">-- ^ Takes the index of node as input</span><span>
</span><a name="line-167"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Takes the index of argument/ parameter as another input</span><span>
</span><a name="line-168"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Name</span><span> </span><span class="hs-comment">-- ^ Builds a temporary variable name in LLVM &quot;Name&quot; Type concatenating the above two inputs</span><span>
</span><a name="line-169"></a><span>    </span><a name="local-6989586621679346197"><a href="#local-6989586621679346197"><span class="hs-identifier">mkTemp2</span></a></a><span> </span><a name="local-6989586621679346206"><a href="#local-6989586621679346206"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679346207"><a href="#local-6989586621679346207"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;s&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679346206"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;_&quot;</span><span class="hs-operator hs-var">++</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679346207"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>
</span><a name="line-171"></a><span>    </span><span class="hs-comment">-- | callFun is used for generating LLVM code for all operations that uses CALL instruction</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-identifier">callFun</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ name of the external function</span><span>
</span><a name="line-173"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ node id</span><span>
</span><a name="line-174"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ input parameter</span><span>
</span><a name="line-175"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Named</span><span> </span><span class="hs-identifier hs-type">AST.Instruction</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ generated LLVM Instruction for the given function</span><span>
</span><a name="line-176"></a><span>    </span><a name="local-6989586621679346198"><a href="#local-6989586621679346198"><span class="hs-identifier">callFun</span></a></a><span> </span><a name="local-6989586621679346208"><a href="#local-6989586621679346208"><span class="hs-identifier">funName</span></a></a><span> </span><a name="local-6989586621679346209"><a href="#local-6989586621679346209"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679346210"><a href="#local-6989586621679346210"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346209"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span> </span><span class="hs-identifier hs-var">AST.Call</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tailCallKind</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- :: Maybe TailCallKind,</span><span>
</span><a name="line-177"></a><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">callingConvention</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CC.C</span><span> </span><span class="hs-comment">-- :: CallingConvention, Found in IR construction Instruction.hs</span><span>
</span><a name="line-178"></a><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">returnAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- :: [PA.ParameterAttribute],</span><span>
</span><a name="line-179"></a><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">C.GlobalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#funcType"><span class="hs-identifier hs-var">funcType</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.ToLLVM.html#nameDef"><span class="hs-identifier hs-var">nameDef</span></a><span> </span><a href="#local-6989586621679346208"><span class="hs-identifier hs-var">funName</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- :: CallableOperand,</span><span>
</span><a name="line-180"></a><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">arguments</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346210"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--  :: [(Operand, [PA.ParameterAttribute])],</span><span>
</span><a name="line-181"></a><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">functionAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- :: [Either FA.GroupID FA.FunctionAttribute],</span><span>
</span><a name="line-182"></a><span>                                                           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">metadata</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- :: InstructionMetadata</span><span>
</span><a name="line-183"></a><span>                                                           </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-comment">-- | arithFun is used for generating LLVM code for arithmetic operations like Add and Mul</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-identifier">arithFun</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">AST.FastMathFlags</span><span> </span><span class="hs-comment">--  Flags for arithmetic instructions in LLVM</span><span>
</span><a name="line-187"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Operand</span><span> </span><span class="hs-comment">--  First operand of the arithmetic instruction</span><span>
</span><a name="line-188"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Operand</span><span> </span><span class="hs-comment">--  Second operand of the arithmetic instruction</span><span>
</span><a name="line-189"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.InstructionMetadata</span><span> </span><span class="hs-comment">--  Specifies Meta data of the instruction. Eg., it says if it is inline or not and so on.</span><span>
</span><a name="line-190"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Instruction</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ All the above inputs gives out this instruction</span><span>
</span><a name="line-191"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ node id</span><span>
</span><a name="line-192"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ list of input parameters</span><span>
</span><a name="line-193"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Named</span><span> </span><span class="hs-identifier hs-type">AST.Instruction</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ generated LLVM instruction for the given arithmetic operation with the given parameters</span><span>
</span><a name="line-194"></a><span>    </span><a name="local-6989586621679346199"><a href="#local-6989586621679346199"><span class="hs-identifier">arithFun</span></a></a><span> </span><a name="local-6989586621679346419"><a href="#local-6989586621679346419"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621679346420"><a href="#local-6989586621679346420"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--  for Zero arguments</span><span>
</span><a name="line-195"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346420"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span>  </span><a href="#local-6989586621679346419"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-196"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>                               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>                               </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier">arithFun</span><span> </span><a name="local-6989586621679346421"><a href="#local-6989586621679346421"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621679346422"><a href="#local-6989586621679346422"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346423"><a href="#local-6989586621679346423"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  For one argument</span><span>
</span><a name="line-200"></a><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679346424"><a href="#local-6989586621679346424"><span class="hs-identifier">argName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346423"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-201"></a><span>                        </span><span class="hs-keyword">in</span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346422"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span>  </span><a href="#local-6989586621679346421"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-202"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-203"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346424"><span class="hs-identifier hs-var">argName</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>                                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-identifier">arithFun</span><span> </span><a name="local-6989586621679346425"><a href="#local-6989586621679346425"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621679346426"><a href="#local-6989586621679346426"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346427"><a href="#local-6989586621679346427"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346428"><a href="#local-6989586621679346428"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  For two arguments</span><span>
</span><a name="line-206"></a><span>                                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679346429"><a href="#local-6989586621679346429"><span class="hs-identifier">argName1</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346427"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-207"></a><span>                                      </span><a name="local-6989586621679346430"><a href="#local-6989586621679346430"><span class="hs-identifier">argName2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346428"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-208"></a><span>                                </span><span class="hs-keyword">in</span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346426"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span>  </span><a href="#local-6989586621679346425"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-209"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346429"><span class="hs-identifier hs-var">argName1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>                                     </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346430"><span class="hs-identifier hs-var">argName2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>                                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-identifier">arithFun</span><span> </span><a name="local-6989586621679346431"><a href="#local-6989586621679346431"><span class="hs-identifier">instr</span></a></a><span> </span><a name="local-6989586621679346432"><a href="#local-6989586621679346432"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346433"><a href="#local-6989586621679346433"><span class="hs-identifier">x</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346434"><a href="#local-6989586621679346434"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346435"><a href="#local-6989586621679346435"><span class="hs-identifier">xs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">--  For more than two arguments, recursive call is used</span><span>
</span><a name="line-213"></a><span>      </span><span class="hs-keyword">let</span><span>
</span><a name="line-214"></a><span>        </span><a name="local-6989586621679346436"><a href="#local-6989586621679346436"><span class="hs-identifier">helper</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346437"><a href="#local-6989586621679346437"><span class="hs-identifier">w1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346438"><a href="#local-6989586621679346438"><span class="hs-identifier">w2</span></a></a><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346197"><span class="hs-identifier hs-var">mkTemp2</span></a><span> </span><a href="#local-6989586621679346437"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679346438"><span class="hs-identifier hs-var">w2</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span>  </span><a href="#local-6989586621679346431"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-215"></a><span>                                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346437"><span class="hs-identifier hs-var">w1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>                                      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346438"><span class="hs-identifier hs-var">w2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>                                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-218"></a><span>        </span><span class="hs-identifier">helper</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679346439"><a href="#local-6989586621679346439"><span class="hs-identifier">w1</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346440"><a href="#local-6989586621679346440"><span class="hs-identifier">w2</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346441"><a href="#local-6989586621679346441"><span class="hs-identifier">w3</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679346442"><a href="#local-6989586621679346442"><span class="hs-identifier">ws</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346436"><span class="hs-identifier hs-var">helper</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346440"><span class="hs-identifier hs-var">w2</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679346442"><span class="hs-identifier hs-var">ws</span></a><span class="hs-special">)</span><span>
</span><a name="line-219"></a><span>                            </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346197"><span class="hs-identifier hs-var">mkTemp2</span></a><span> </span><a href="#local-6989586621679346439"><span class="hs-identifier hs-var">w1</span></a><span> </span><a href="#local-6989586621679346440"><span class="hs-identifier hs-var">w2</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span>  </span><a href="#local-6989586621679346431"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-220"></a><span>                                                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346439"><span class="hs-identifier hs-var">w1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>                                                                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346197"><span class="hs-identifier hs-var">mkTemp2</span></a><span> </span><a href="#local-6989586621679346440"><span class="hs-identifier hs-var">w2</span></a><span> </span><a href="#local-6989586621679346441"><span class="hs-identifier hs-var">w3</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-222"></a><span>                                                                 </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-223"></a><span>      </span><span class="hs-keyword">in</span><span>
</span><a name="line-224"></a><span>        </span><a href="#local-6989586621679346436"><span class="hs-identifier hs-var">helper</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346434"><span class="hs-identifier hs-var">y</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679346435"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>        </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346432"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span> </span><a href="#local-6989586621679346431"><span class="hs-identifier hs-var">instr</span></a><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-226"></a><span>                                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346197"><span class="hs-identifier hs-var">mkTemp2</span></a><span> </span><a href="#local-6989586621679346432"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346434"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-227"></a><span>                                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346433"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>                                              </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>
</span><a name="line-230"></a><span>    </span><span class="hs-comment">-- | gets the dimension of the expressionMap</span><span>
</span><a name="line-231"></a><span>    </span><span class="hs-identifier">getShape</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Node id of the expression map</span><span>
</span><a name="line-232"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Expression.html#Shape"><span class="hs-identifier hs-type">Shape</span></a><span> </span><span class="hs-comment">-- ^ Dimension /shape of the expression map</span><span>
</span><a name="line-233"></a><span>    </span><a name="local-6989586621679346200"><a href="#local-6989586621679346200"><span class="hs-identifier">getShape</span></a></a><span> </span><a name="local-6989586621679346443"><a href="#local-6989586621679346443"><span class="hs-identifier">nId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679346443"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679346192"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span>    </span><span class="hs-comment">-- | generates LLVM Definition based on the node id obtained from the topological sort</span><span>
</span><a name="line-236"></a><span>    </span><span class="hs-identifier">genCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Node id of the expression map</span><span>
</span><a name="line-237"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#Code"><span class="hs-identifier hs-type">Code</span></a><span> </span><span class="hs-comment">-- ^ generates corresponding LLVM instruction</span><span>
</span><a name="line-238"></a><span>    </span><a name="local-6989586621679346201"><a href="#local-6989586621679346201"><span class="hs-identifier">genCode</span></a></a><span> </span><a name="local-6989586621679346444"><a href="#local-6989586621679346444"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-239"></a><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679346445"><a href="#local-6989586621679346445"><span class="hs-identifier">shape</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346446"><a href="#local-6989586621679346446"><span class="hs-identifier">op</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveInternal"><span class="hs-identifier hs-var">retrieveInternal</span></a><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346192"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-240"></a><span>          </span><a name="local-6989586621679346447"><a href="#local-6989586621679346447"><span class="hs-identifier">elementType</span></a></a><span> </span><a name="local-6989586621679346448"><a href="#local-6989586621679346448"><span class="hs-identifier">nId</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveElementType"><span class="hs-identifier hs-var">retrieveElementType</span></a><span> </span><a href="#local-6989586621679346448"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679346192"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-241"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679346446"><span class="hs-identifier hs-var">op</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-242"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Var"><span class="hs-identifier hs-var">Var</span></a><span> </span><a name="local-6989586621679346449"><a href="#local-6989586621679346449"><span class="hs-identifier">nam</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">--varName = mkTemp nam</span><span>
</span><a name="line-243"></a><span>                         </span><a name="local-6989586621679346450"><a href="#local-6989586621679346450"><span class="hs-identifier">parIdx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">lookup</span><span> </span><a href="#local-6989586621679346449"><span class="hs-identifier hs-var">nam</span></a><span> </span><a href="#local-6989586621679346195"><span class="hs-identifier hs-var">parameterMap</span></a><span>
</span><a name="line-244"></a><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-245"></a><span>           </span><span class="hs-comment">--  For scalars we dont allocate space for local variables. We use mkTemp to refer to the variable name directly.</span><span>
</span><a name="line-246"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#DVar"><span class="hs-identifier hs-var">DVar</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;DVar not available for Scalars&quot;</span><span>
</span><a name="line-247"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Const"><span class="hs-identifier hs-var">Const</span></a><span> </span><a name="local-6989586621679346451"><a href="#local-6989586621679346451"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span>   </span><span class="hs-identifier hs-var">AST.FAdd</span><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-248"></a><span>                                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Check me - Type of var and const</span><span>
</span><a name="line-249"></a><span>                                              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><a href="#local-6989586621679346451"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-250"></a><span>                                              </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- show val]&quot;</span><span>
</span><a name="line-251"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679346452"><a href="#local-6989586621679346452"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346199"><span class="hs-identifier hs-var">arithFun</span></a><span> </span><span class="hs-identifier hs-var">AST.FAdd</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346452"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-252"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679346453"><a href="#local-6989586621679346453"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346199"><span class="hs-identifier hs-var">arithFun</span></a><span> </span><span class="hs-identifier hs-var">AST.FMul</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346453"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-253"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679346454"><a href="#local-6989586621679346454"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679346455"><a href="#local-6989586621679346455"><span class="hs-identifier">arg</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span> </span><span class="hs-identifier hs-var">AST.Call</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">tailCallKind</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-comment">-- :: Maybe TailCallKind,</span><span>
</span><a name="line-254"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">callingConvention</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">CC.C</span><span> </span><span class="hs-comment">-- :: CallingConvention, Found in IR construction Instruction.hs</span><span>
</span><a name="line-255"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">returnAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- :: [PA.ParameterAttribute],</span><span>
</span><a name="line-256"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">function</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">C.GlobalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#funcType2"><span class="hs-identifier hs-var">funcType2</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;llvm.pow.f64&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- :: CallableOperand,</span><span>
</span><a name="line-257"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">arguments</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346455"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span class="hs-special">(</span><a href="#local-6989586621679346454"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">functionAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- :: [Either FA.GroupID FA.FunctionAttribute],</span><span>
</span><a name="line-259"></a><span>                                                      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">metadata</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- :: InstructionMetadata</span><span>
</span><a name="line-260"></a><span>                                                      </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-261"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Neg"><span class="hs-identifier hs-var">Neg</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679346456"><a href="#local-6989586621679346456"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679346457"><a href="#local-6989586621679346457"><span class="hs-identifier">argName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346456"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-262"></a><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span> </span><span class="hs-identifier hs-var">AST.FSub</span><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-263"></a><span>                                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.ConstantOperand</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">C.Float</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">LLVM.AST.Float.Double</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-264"></a><span>                                                  </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346457"><span class="hs-identifier hs-var">argName</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>                                     </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- need to generate address, load, negate, address and store (and two temporary) for non scalars</span><span>
</span><a name="line-266"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679346458"><a href="#local-6989586621679346458"><span class="hs-identifier">scalar</span></a></a><span> </span><a name="local-6989586621679346459"><a href="#local-6989586621679346459"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Scale should not be here&quot;</span><span> </span><span class="hs-comment">-- Not relevant to scalar operations</span><span>
</span><a name="line-267"></a><span>          </span><span class="hs-comment">-- MARK: only applicable to Real</span><span>
</span><a name="line-268"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Div"><span class="hs-identifier hs-var">Div</span></a><span> </span><a name="local-6989586621679346460"><a href="#local-6989586621679346460"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621679346461"><a href="#local-6989586621679346461"><span class="hs-identifier">arg2</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-operator hs-var">AST.:=</span><span> </span><span class="hs-identifier hs-var">AST.FDiv</span><span> </span><span class="hs-identifier hs-var">AST.noFastMathFlags</span><span>
</span><a name="line-269"></a><span>                                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346460"><span class="hs-identifier hs-var">arg1</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-270"></a><span>                                                   </span><span class="hs-special">(</span><span class="hs-identifier hs-var">AST.LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346461"><span class="hs-identifier hs-var">arg2</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-271"></a><span>                                                   </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-272"></a><span>                         </span><span class="hs-comment">--error &quot;Div not implemented&quot;</span><span>
</span><a name="line-273"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Sqrt"><span class="hs-identifier hs-var">Sqrt</span></a><span> </span><a name="local-6989586621679346462"><a href="#local-6989586621679346462"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;sqrt&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346462"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-274"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;sqrt&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-275"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Sin"><span class="hs-identifier hs-var">Sin</span></a><span> </span><a name="local-6989586621679346463"><a href="#local-6989586621679346463"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;sin&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346463"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-276"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;sin&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-277"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Cos"><span class="hs-identifier hs-var">Cos</span></a><span> </span><a name="local-6989586621679346464"><a href="#local-6989586621679346464"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;cos&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346464"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-278"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;cos&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-279"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Tan"><span class="hs-identifier hs-var">Tan</span></a><span> </span><a name="local-6989586621679346465"><a href="#local-6989586621679346465"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;tan&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346465"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-280"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;tan&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-281"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Exp"><span class="hs-identifier hs-var">Exp</span></a><span> </span><a name="local-6989586621679346466"><a href="#local-6989586621679346466"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;exp&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346466"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-282"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;exp&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-283"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Log"><span class="hs-identifier hs-var">Log</span></a><span> </span><a name="local-6989586621679346467"><a href="#local-6989586621679346467"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;log&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346467"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-284"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;log&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-285"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Sinh"><span class="hs-identifier hs-var">Sinh</span></a><span> </span><a name="local-6989586621679346468"><a href="#local-6989586621679346468"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;sinh&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346468"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-286"></a><span>                    </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;sinh&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-287"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Cosh"><span class="hs-identifier hs-var">Cosh</span></a><span> </span><a name="local-6989586621679346469"><a href="#local-6989586621679346469"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;cosh&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346469"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-288"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;cosh&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-289"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Tanh"><span class="hs-identifier hs-var">Tanh</span></a><span> </span><a name="local-6989586621679346470"><a href="#local-6989586621679346470"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;tanh&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346470"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-290"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;tanh&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-291"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Asin"><span class="hs-identifier hs-var">Asin</span></a><span> </span><a name="local-6989586621679346471"><a href="#local-6989586621679346471"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;asin&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346471"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-292"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;asin&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-293"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Acos"><span class="hs-identifier hs-var">Acos</span></a><span> </span><a name="local-6989586621679346472"><a href="#local-6989586621679346472"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;acos&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346472"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-294"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;acos&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-295"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Atan"><span class="hs-identifier hs-var">Atan</span></a><span> </span><a name="local-6989586621679346473"><a href="#local-6989586621679346473"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;atan&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346473"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-296"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;atan&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-297"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Asinh"><span class="hs-identifier hs-var">Asinh</span></a><span> </span><a name="local-6989586621679346474"><a href="#local-6989586621679346474"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;asinh&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346474"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-298"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;asinh&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-299"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Acosh"><span class="hs-identifier hs-var">Acosh</span></a><span> </span><a name="local-6989586621679346475"><a href="#local-6989586621679346475"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;acosh&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346475"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-300"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;acosh&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-301"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Atanh"><span class="hs-identifier hs-var">Atanh</span></a><span> </span><a name="local-6989586621679346476"><a href="#local-6989586621679346476"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679346198"><span class="hs-identifier hs-var">callFun</span></a><span> </span><span class="hs-string">&quot;atanh&quot;</span><span> </span><a href="#local-6989586621679346444"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679346476"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-302"></a><span>                      </span><span class="hs-comment">--error &quot;for i n [n `at` i &lt;&lt;- &quot;atanh&quot; ++ arg `at` i]&quot;</span><span>
</span><a name="line-303"></a><span>          </span><span class="hs-comment">-- MARK: Complex related. Not related to Scalar</span><span>
</span><a name="line-304"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#RealImag"><span class="hs-identifier hs-var">RealImag</span></a><span> </span><a name="local-6989586621679346477"><a href="#local-6989586621679346477"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621679346478"><a href="#local-6989586621679346478"><span class="hs-identifier">arg2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;RealImag not applicable for scalars&quot;</span><span>
</span><a name="line-305"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#RealPart"><span class="hs-identifier hs-var">RealPart</span></a><span> </span><a name="local-6989586621679346479"><a href="#local-6989586621679346479"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;RealPart not applicable for scalars&quot;</span><span>
</span><a name="line-306"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#ImagPart"><span class="hs-identifier hs-var">ImagPart</span></a><span> </span><a name="local-6989586621679346480"><a href="#local-6989586621679346480"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;ImagPart not applicable for scalars&quot;</span><span>
</span><a name="line-307"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#InnerProd"><span class="hs-identifier hs-var">InnerProd</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679346481"><a href="#local-6989586621679346481"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621679346482"><a href="#local-6989586621679346482"><span class="hs-identifier">arg2</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;InnerProd not applicable for scalars&quot;</span><span>
</span><a name="line-308"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Piecewise"><span class="hs-identifier hs-var">Piecewise</span></a><span> </span><a name="local-6989586621679346483"><a href="#local-6989586621679346483"><span class="hs-identifier">marks</span></a></a><span> </span><a name="local-6989586621679346484"><a href="#local-6989586621679346484"><span class="hs-identifier">condition</span></a></a><span> </span><a name="local-6989586621679346485"><a href="#local-6989586621679346485"><span class="hs-identifier">branches</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Piecewise not applicable for scalars&quot;</span><span>
</span><a name="line-309"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Rotate"><span class="hs-identifier hs-var">Rotate</span></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679346486"><a href="#local-6989586621679346486"><span class="hs-identifier">amount</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621679346487"><a href="#local-6989586621679346487"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Rotate 1D not applicable for scalars&quot;</span><span>
</span><a name="line-310"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Rotate"><span class="hs-identifier hs-var">Rotate</span></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679346488"><a href="#local-6989586621679346488"><span class="hs-identifier">amount1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346489"><a href="#local-6989586621679346489"><span class="hs-identifier">amount2</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621679346490"><a href="#local-6989586621679346490"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Rotate 2D not applicable for scalars&quot;</span><span>
</span><a name="line-311"></a><span>          </span><a href="HashedExpression.Internal.Expression.html#Rotate"><span class="hs-identifier hs-var">Rotate</span></a><span> </span><span class="hs-special">[</span><a name="local-6989586621679346491"><a href="#local-6989586621679346491"><span class="hs-identifier">amount1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346492"><a href="#local-6989586621679346492"><span class="hs-identifier">amount2</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346493"><a href="#local-6989586621679346493"><span class="hs-identifier">amount3</span></a></a><span class="hs-special">]</span><span> </span><a name="local-6989586621679346494"><a href="#local-6989586621679346494"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;Rotate 3D not applicable for scalars&quot;</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span>    </span><span class="hs-comment">-- | defines the body of the LLVM module</span><span>
</span><a name="line-314"></a><span>    </span><a name="local-6989586621679346202"><a href="#local-6989586621679346202"><span class="hs-identifier">body</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">BasicBlock</span><span> </span><span class="hs-comment">--  body of the LLVM module</span><span>
</span><a name="line-315"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Name</span><span> </span><span class="hs-string">&quot;entry&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  defines the entry of the LLVM Module</span><span>
</span><a name="line-316"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">concatMap</span><span> </span><a href="#local-6989586621679346201"><span class="hs-identifier hs-var">genCode</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Inner.html#topologicalSortManyRoots"><span class="hs-identifier hs-var">topologicalSortManyRoots</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346192"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346193"><span class="hs-identifier hs-var">rootIds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  gets all expression, sort them, generates LLVM instructions as per the sorted node ids</span><span>
</span><a name="line-317"></a><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Do</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Ret</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">LocalReference</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679346196"><span class="hs-identifier hs-var">mkTemp</span></a><span> </span><a href="#local-6989586621679346193"><span class="hs-identifier hs-var">rootIds</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  return variable</span><span>
</span><a name="line-318"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-319"></a><span>    </span><span class="hs-identifier hs-var">GlobalDefinition</span><span> </span><span class="hs-identifier hs-var">functionDefaults</span><span> </span><span class="hs-comment">--  Actual definition of LLVM Module</span><span>
</span><a name="line-320"></a><span>       </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><a href="#local-6989586621679346190"><span class="hs-identifier hs-var">funcName</span></a><span> </span><span class="hs-comment">-- Name of the function</span><span>
</span><a name="line-321"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parameters</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-322"></a><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">Parameter</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><a href="#local-6989586621679346495"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679346495"><a href="#local-6989586621679346495"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679346194"><span class="hs-identifier hs-var">sortedVars</span></a><span> </span><span class="hs-special">]</span><span> </span><span class="hs-comment">--  Input parameters which is sorted</span><span>
</span><a name="line-323"></a><span>           </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-324"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">returnType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-comment">--  Return type of the module</span><span>
</span><a name="line-325"></a><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">basicBlocks</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679346202"><span class="hs-identifier hs-var">body</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">--  calling Body of LLVM module</span><span>
</span><a name="line-326"></a><span>       </span><span class="hs-special">}</span><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-comment">-- | defining type of functions</span><span>
</span><a name="line-329"></a><a name="funcType"><a href="HashedExpression.Internal.ToLLVM.html#funcType"><span class="hs-identifier">funcType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ptr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">FunctionType</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-330"></a><a name="funcType2"><a href="HashedExpression.Internal.ToLLVM.html#funcType2"><span class="hs-identifier">funcType2</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">ptr</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">FunctionType</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span class="hs-special">,</span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span class="hs-special">]</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | Function to generate LLVM IR to declare the signature of an external function.</span><span>
</span><a name="line-333"></a><span class="hs-comment">-- | nameDef -&gt; String -&gt; AST.Name</span><span>
</span><a name="line-334"></a><span class="hs-identifier">nameDef</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ Name of the external function in terms of string</span><span>
</span><a name="line-335"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Name</span><span> </span><span class="hs-comment">-- ^ Name of the external function in LLVM &quot;Name&quot; Type</span><span>
</span><a name="line-336"></a><a name="nameDef"><a href="HashedExpression.Internal.ToLLVM.html#nameDef"><span class="hs-identifier">nameDef</span></a></a><span> </span><a name="local-6989586621679346496"><a href="#local-6989586621679346496"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-337"></a><span>                          </span><span class="hs-string">&quot;sin&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;.f64&quot;</span><span>
</span><a name="line-338"></a><span>                          </span><span class="hs-string">&quot;cos&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;.f64&quot;</span><span>
</span><a name="line-339"></a><span>                          </span><span class="hs-string">&quot;log&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;.f64&quot;</span><span>
</span><a name="line-340"></a><span>                          </span><span class="hs-string">&quot;exp&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;.f64&quot;</span><span>
</span><a name="line-341"></a><span>                          </span><span class="hs-string">&quot;pow&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;.f64&quot;</span><span>
</span><a name="line-342"></a><span>                          </span><span class="hs-string">&quot;sqrt&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;llvm.&quot;</span><span class="hs-operator hs-var">++</span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;.f64&quot;</span><span>
</span><a name="line-343"></a><span>                          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">mkName</span><span> </span><a href="#local-6989586621679346496"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-344"></a><span>
</span><a name="line-345"></a><span>
</span><a name="line-346"></a><span class="hs-comment">-- | @mkModule@ function for combining all generated LLVM Definitions to a single LLVM module</span><span>
</span><a name="line-347"></a><span class="hs-comment">-- | mkModule :: String -&gt; Expression d et -&gt; AST.Module</span><span>
</span><a name="line-348"></a><span class="hs-identifier">mkModule</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^ name for the LLVM module to be generated</span><span>
</span><a name="line-349"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-type">Expression</span></a><span> </span><a href="#local-6989586621679346177"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="#local-6989586621679346178"><span class="hs-identifier hs-type">et</span></a><span>  </span><span class="hs-comment">-- ^ It is the node id for the final expression. `d` is the expressionID and `et` is the expressionMap</span><span>
</span><a name="line-350"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">AST.Module</span><span> </span><span class="hs-comment">-- ^ LLVM module that has all generated LLVM Definitions</span><span>
</span><a name="line-351"></a><a name="mkModule"><a href="HashedExpression.Internal.ToLLVM.html#mkModule"><span class="hs-identifier">mkModule</span></a></a><span> </span><a name="local-6989586621679346497"><a href="#local-6989586621679346497"><span class="hs-identifier">funcName</span></a></a><span> </span><a name="local-6989586621679346498"><a href="#local-6989586621679346498"><span class="hs-identifier">exp</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-352"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-353"></a><span>    </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-var">Expression</span></a><span> </span><a name="local-6989586621679346499"><a href="#local-6989586621679346499"><span class="hs-identifier">topLevel</span></a></a><span> </span><a name="local-6989586621679346500"><a href="#local-6989586621679346500"><span class="hs-identifier">exprMap</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346498"><span class="hs-identifier hs-var">exp</span></a><span>
</span><a name="line-354"></a><span>    </span><a name="local-6989586621679346501"><a href="#local-6989586621679346501"><span class="hs-identifier">llvmMemMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#makeLLVMMemMap"><span class="hs-identifier hs-var">makeLLVMMemMap</span></a><span> </span><a href="#local-6989586621679346500"><span class="hs-identifier hs-var">exprMap</span></a><span>
</span><a name="line-355"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-356"></a><span>    </span><span class="hs-identifier hs-var">defaultModule</span><span> </span><span class="hs-comment">--  has parameters for the default LLVM module</span><span>
</span><a name="line-357"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">moduleName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;basic&quot;</span><span> </span><span class="hs-comment">--  describes the module id to be generated in LLVM code</span><span>
</span><a name="line-358"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">moduleSourceFileName</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;Main.hs&quot;</span><span> </span><span class="hs-comment">--  Describes the source file name from which LLVM code is generated</span><span>
</span><a name="line-359"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">moduleDefinitions</span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#generateEvaluatingCodes"><span class="hs-identifier hs-var">generateEvaluatingCodes</span></a><span> </span><a href="#local-6989586621679346497"><span class="hs-identifier hs-var">funcName</span></a><span> </span><a href="#local-6989586621679346501"><span class="hs-identifier hs-var">llvmMemMap</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679346500"><span class="hs-identifier hs-var">exprMap</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679346499"><span class="hs-identifier hs-var">topLevel</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">--  Complete LLVM module generation which calls generateEvaluatingCodes function with the expression map</span><span>
</span><a name="line-360"></a><span>      </span><span class="hs-operator hs-var">++</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#externals"><span class="hs-identifier hs-var">externals</span></a><span> </span><span class="hs-comment">--  External function call declarations in the LLVM program</span><span>
</span><a name="line-361"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-comment">-- | Declaration of all functions used from the built-in math library.</span><span>
</span><a name="line-364"></a><span class="hs-identifier">externals</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">AST.Definition</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ List of LLVM Definitions</span><span>
</span><a name="line-365"></a><a name="externals"><a href="HashedExpression.Internal.ToLLVM.html#externals"><span class="hs-identifier">externals</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-366"></a><span>  </span><span class="hs-keyword">let</span><span>
</span><a name="line-367"></a><span>    </span><a name="local-6989586621679346502"><a href="#local-6989586621679346502"><span class="hs-identifier">onePar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Parameter</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  Parameter list for functions with one parameter</span><span>
</span><a name="line-368"></a><span>    </span><a name="local-6989586621679346503"><a href="#local-6989586621679346503"><span class="hs-identifier">twoPar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Parameter</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Parameter</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">mkName</span><span> </span><span class="hs-string">&quot;&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span> </span><span class="hs-comment">--  Parameter list for functions with two parameter</span><span>
</span><a name="line-369"></a><span>    </span><a name="local-6989586621679346504"><a href="#local-6989586621679346504"><span class="hs-identifier">defn</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679346505"><a href="#local-6989586621679346505"><span class="hs-identifier">name</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346506"><a href="#local-6989586621679346506"><span class="hs-identifier">attrs</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679346507"><a href="#local-6989586621679346507"><span class="hs-identifier">par</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">GlobalDefinition</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">functionDefaults</span><span> </span><span class="hs-comment">--  External Function declaration</span><span>
</span><a name="line-370"></a><span>      </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">name</span><span>       </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#nameDef"><span class="hs-identifier hs-var">nameDef</span></a><span> </span><a href="#local-6989586621679346505"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-comment">--  Name of the function</span><span>
</span><a name="line-371"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">linkage</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">External</span><span> </span><span class="hs-comment">--  For external symbol references</span><span>
</span><a name="line-372"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parameters</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346507"><span class="hs-identifier hs-var">par</span></a><span> </span><span class="hs-comment">--  Parameter list</span><span>
</span><a name="line-373"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">returnType</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.ToLLVM.html#elemType"><span class="hs-identifier hs-var">elemType</span></a><span> </span><span class="hs-comment">-- Return type of the function</span><span>
</span><a name="line-374"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">LLVM.AST.Global.functionAttributes</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679346506"><span class="hs-identifier hs-var">attrs</span></a><span> </span><span class="hs-comment">-- Attributes of the function</span><span>
</span><a name="line-375"></a><span>      </span><span class="hs-special">}</span><span>
</span><a name="line-376"></a><span>  </span><span class="hs-keyword">in</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679346504"><span class="hs-identifier hs-var">defn</span></a><span>
</span><a name="line-378"></a><span>      </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;sin&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.Speculatable</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cos&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.Speculatable</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-380"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;tan&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-381"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;sinh&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-382"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cosh&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;tanh&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-384"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;asin&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-385"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;acos&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-386"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;atan&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-387"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;asinh&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;acosh&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-389"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;atanh&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-390"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;exp&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.Speculatable</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-391"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;log&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.Speculatable</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-392"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;pow&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.Speculatable</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346503"><span class="hs-identifier hs-var">twoPar</span></a><span class="hs-special">)</span><span>
</span><a name="line-393"></a><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;sqrt&quot;</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.NoUnwind</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.ReadNone</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-identifier hs-var">FA.Speculatable</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679346502"><span class="hs-identifier hs-var">onePar</span></a><span class="hs-special">)</span><span>
</span><a name="line-394"></a><span>      </span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- from IRBuilder.Module</span><span>
</span><a name="line-395"></a><span>
</span><a name="line-396"></a><span class="hs-comment">-- | Steps to execute</span><span>
</span><a name="line-397"></a><span class="hs-comment">-- </span><span>
</span><a name="line-398"></a><span class="hs-comment">-- [Go to the folder app in the HashedExpression]</span><span>
</span><a name="line-399"></a><span class="hs-comment">-- </span><span>
</span><a name="line-400"></a><span class="hs-comment">-- &gt;&gt;&gt; stack ghci Main.hs</span><span>
</span><a name="line-401"></a><span class="hs-comment">--</span><span>
</span><a name="line-402"></a><span class="hs-comment">-- &gt;&gt;&gt; Prelude&gt; main</span><span>
</span><a name="line-403"></a><span class="hs-comment">--</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- [LLVM Generated Code]</span><span>
</span><a name="line-405"></a><span class="hs-comment">--</span><span>
</span><a name="line-406"></a><span class="hs-comment">-- [OR]</span><span>
</span><a name="line-407"></a><span class="hs-comment">--</span><span>
</span><a name="line-408"></a><span class="hs-comment">-- [Go to the project folder]</span><span>
</span><a name="line-409"></a><span class="hs-comment">--</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- &gt;&gt;&gt; stack build</span><span>
</span><a name="line-411"></a><span class="hs-comment">--</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- &gt;&gt;&gt; stack run</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- </span><span>
</span><a name="line-414"></a><span class="hs-comment">-- [LLVM Generated code]</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- </span><span>
</span><a name="line-416"></a><span class="hs-comment">-- [LLVM code is also found in the generated file specified in the Main.hs]</span><span>
</span><a name="line-417"></a><span class="hs-comment">-- </span><span>
</span><a name="line-418"></a><span class="hs-comment">-- [To check the output with C file]</span><span>
</span><a name="line-419"></a><span class="hs-comment">--</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- &gt;&gt;&gt; clang sampleMod.ll testMain.c -O3 -o test.exe</span><span>
</span><a name="line-421"></a><span class="hs-comment">--</span><span>
</span><a name="line-422"></a><span class="hs-comment">-- &gt;&gt;&gt; ./test.exe</span><span>
</span><a name="line-423"></a><span class="hs-comment">--</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- &gt;&gt;&gt; 0.841471 [Some output based on the LLVM code and given input from C file] </span><span>
</span><a name="line-425"></a></pre></body></html>