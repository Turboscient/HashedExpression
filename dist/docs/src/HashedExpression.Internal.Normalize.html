<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- | For normalizeing expressions</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-5"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">HashedExpression.Internal.Normalize</span><span>
</span><a name="line-6"></a><span>    </span><span class="hs-special">(</span><span> </span><a href="HashedExpression.Internal.Normalize.html#normalize"><span class="hs-identifier hs-var">normalize</span></a><span>
</span><a name="line-7"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#normalizingTransformation"><span class="hs-identifier hs-var">normalizingTransformation</span></a><span>
</span><a name="line-8"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#flattenSumProdRules"><span class="hs-identifier hs-var">flattenSumProdRules</span></a><span>
</span><a name="line-9"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#toMultiplyIfPossible"><span class="hs-identifier hs-var">toMultiplyIfPossible</span></a><span>
</span><a name="line-10"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Eq.HT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">equating</span><span class="hs-special">)</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Function.HT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">nest</span><span class="hs-special">)</span><span>
</span><a name="line-14"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntMap.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IM</span><span>
</span><a name="line-15"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntSet</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IS</span><span>
</span><a name="line-16"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">find</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">foldl'</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">group</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">partition</span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sort</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortBy</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sortOn</span><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">transpose</span><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.Extra</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">firstJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">groupSort</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">groupWith</span><span class="hs-special">)</span><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-31"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">catMaybes</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">fromJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isJust</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">isNothing</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">mapMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Debug.Trace</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">traceShow</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">traceShowId</span><span class="hs-special">)</span><span>
</span><a name="line-33"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Exts</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">sortWith</span><span class="hs-special">)</span><span>
</span><a name="line-34"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Expression.html"><span class="hs-identifier">HashedExpression.Internal.Expression</span></a><span>
</span><a name="line-35"></a><span>
</span><a name="line-36"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Hash.html"><span class="hs-identifier">HashedExpression.Internal.Hash</span></a><span>
</span><a name="line-37"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Inner.html"><span class="hs-identifier">HashedExpression.Internal.Inner</span></a><span>
</span><a name="line-38"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Node.html"><span class="hs-identifier">HashedExpression.Internal.Node</span></a><span>
</span><a name="line-39"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Pattern.html"><span class="hs-identifier">HashedExpression.Internal.Pattern</span></a><span>
</span><a name="line-40"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Internal.Utils.html"><span class="hs-identifier">HashedExpression.Internal.Utils</span></a><span>
</span><a name="line-41"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Operation.html"><span class="hs-identifier">HashedExpression.Operation</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Operation.html#constant"><span class="hs-identifier hs-var">constant</span></a><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span class="hs-keyword">import</span><span> </span><a href="HashedExpression.Prettify.html"><span class="hs-identifier">HashedExpression.Prettify</span></a><span>
</span><a name="line-43"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">^</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">product</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">sum</span><span class="hs-special">)</span><span>
</span><a name="line-44"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Prelude</span><span>
</span><a name="line-45"></a><span>
</span><a name="line-46"></a><span class="hs-comment">-- | For debugging a single normalizier rule</span><span>
</span><a name="line-47"></a><span class="hs-comment">--</span><span>
</span><a name="line-48"></a><span class="hs-identifier">makeTrans</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-49"></a><span>       </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#DimensionType"><span class="hs-identifier hs-type">DimensionType</span></a><span> </span><a href="#local-6989586621679403651"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#ElementType"><span class="hs-identifier hs-type">ElementType</span></a><span> </span><a href="#local-6989586621679403652"><span class="hs-identifier hs-type">et</span></a><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-type">Expression</span></a><span> </span><a href="#local-6989586621679403651"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="#local-6989586621679403652"><span class="hs-identifier hs-type">et</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-type">Expression</span></a><span> </span><a href="#local-6989586621679403651"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="#local-6989586621679403652"><span class="hs-identifier hs-type">et</span></a><span>
</span><a name="line-53"></a><a name="makeTrans"><a href="HashedExpression.Internal.Normalize.html#makeTrans"><span class="hs-identifier">makeTrans</span></a></a><span> </span><a name="local-6989586621679403653"><a href="#local-6989586621679403653"><span class="hs-identifier">smp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#wrap"><span class="hs-identifier hs-var">wrap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679403653"><span class="hs-identifier hs-var">smp</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#unwrap"><span class="hs-identifier hs-var">unwrap</span></a><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">-- | Normalize an expression</span><span>
</span><a name="line-56"></a><span class="hs-comment">--</span><span>
</span><a name="line-57"></a><span class="hs-identifier">normalize</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-58"></a><span>       </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#DimensionType"><span class="hs-identifier hs-type">DimensionType</span></a><span> </span><a href="#local-6989586621679403649"><span class="hs-identifier hs-type">d</span></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#ElementType"><span class="hs-identifier hs-type">ElementType</span></a><span> </span><a href="#local-6989586621679403650"><span class="hs-identifier hs-type">et</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-type">Expression</span></a><span> </span><a href="#local-6989586621679403649"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="#local-6989586621679403650"><span class="hs-identifier hs-type">et</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Expression.html#Expression"><span class="hs-identifier hs-type">Expression</span></a><span> </span><a href="#local-6989586621679403649"><span class="hs-identifier hs-type">d</span></a><span> </span><a href="#local-6989586621679403650"><span class="hs-identifier hs-type">et</span></a><span>
</span><a name="line-59"></a><a name="normalize"><a href="HashedExpression.Internal.Normalize.html#normalize"><span class="hs-identifier">normalize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#wrap"><span class="hs-identifier hs-var">wrap</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Normalize.html#normalizingTransformation"><span class="hs-identifier hs-var">normalizingTransformation</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#unwrap"><span class="hs-identifier hs-var">unwrap</span></a><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-comment">-- | Combine all the transformations</span><span>
</span><a name="line-62"></a><span class="hs-comment">--</span><span>
</span><a name="line-63"></a><span class="hs-identifier">normalizingTransformation</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a><span>
</span><a name="line-64"></a><a name="normalizingTransformation"><a href="HashedExpression.Internal.Normalize.html#normalizingTransformation"><span class="hs-identifier">normalizingTransformation</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679403655"><span class="hs-identifier hs-var">secondPass</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679403654"><span class="hs-identifier hs-var">firstPass</span></a><span>
</span><a name="line-65"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>    </span><a name="local-6989586621679403654"><a href="#local-6989586621679403654"><span class="hs-identifier">firstPass</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-67"></a><span>        </span><a href="HashedExpression.Internal.Inner.html#multipleTimes"><span class="hs-identifier hs-var">multipleTimes</span></a><span> </span><span class="hs-number">100</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Utils.html#chain"><span class="hs-identifier hs-var">chain</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-68"></a><span>        </span><span class="hs-identifier hs-var">map</span><span>
</span><a name="line-69"></a><span>            </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Normalize.html#toRecursiveSimplification"><span class="hs-identifier hs-var">toRecursiveSimplification</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#fromModification"><span class="hs-identifier hs-var">fromModification</span></a><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span>            </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Normalize.html#evaluateIfPossibleRules"><span class="hs-identifier hs-var">evaluateIfPossibleRules</span></a><span>
</span><a name="line-71"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#groupConstantsRules"><span class="hs-identifier hs-var">groupConstantsRules</span></a><span>
</span><a name="line-72"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#combineTermsRules"><span class="hs-identifier hs-var">combineTermsRules</span></a><span>
</span><a name="line-73"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#combineTermsRulesProd"><span class="hs-identifier hs-var">combineTermsRulesProd</span></a><span>
</span><a name="line-74"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#powerProdRules"><span class="hs-identifier hs-var">powerProdRules</span></a><span>
</span><a name="line-75"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#powerScaleRules"><span class="hs-identifier hs-var">powerScaleRules</span></a><span>
</span><a name="line-76"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#combinePowerRules"><span class="hs-identifier hs-var">combinePowerRules</span></a><span>
</span><a name="line-77"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#powerSumRealImagRules"><span class="hs-identifier hs-var">powerSumRealImagRules</span></a><span>
</span><a name="line-78"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#combineRealScalarRules"><span class="hs-identifier hs-var">combineRealScalarRules</span></a><span>
</span><a name="line-79"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#flattenSumProdRules"><span class="hs-identifier hs-var">flattenSumProdRules</span></a><span>
</span><a name="line-80"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#zeroOneSumProdRules"><span class="hs-identifier hs-var">zeroOneSumProdRules</span></a><span>
</span><a name="line-81"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#collapseSumProdRules"><span class="hs-identifier hs-var">collapseSumProdRules</span></a><span>
</span><a name="line-82"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#normalizeRotateRules"><span class="hs-identifier hs-var">normalizeRotateRules</span></a><span>
</span><a name="line-83"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#negativeZeroRules"><span class="hs-identifier hs-var">negativeZeroRules</span></a><span>
</span><a name="line-84"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#pullOutPiecewiseRules"><span class="hs-identifier hs-var">pullOutPiecewiseRules</span></a><span>
</span><a name="line-85"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#expandPiecewiseRealImag"><span class="hs-identifier hs-var">expandPiecewiseRealImag</span></a><span>
</span><a name="line-86"></a><span>            </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#twiceReFTAndImFTRules"><span class="hs-identifier hs-var">twiceReFTAndImFTRules</span></a><span>
</span><a name="line-87"></a><span>            </span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-88"></a><span>        </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Normalize.html#rulesFromPattern"><span class="hs-identifier hs-var">rulesFromPattern</span></a><span> </span><span class="hs-comment">--</span><span>
</span><a name="line-89"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Inner.html#removeUnreachable"><span class="hs-identifier hs-var">removeUnreachable</span></a><span>
</span><a name="line-90"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-91"></a><span>    </span><a name="local-6989586621679403655"><a href="#local-6989586621679403655"><span class="hs-identifier">secondPass</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Normalize.html#toMultiplyIfPossible"><span class="hs-identifier hs-var">toMultiplyIfPossible</span></a><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-comment">-- | Turn a modification to a recursive transformation</span><span>
</span><a name="line-94"></a><span class="hs-comment">--</span><span>
</span><a name="line-95"></a><span class="hs-identifier">toRecursiveSimplification</span><span> </span><span class="hs-glyph">::</span><span>
</span><a name="line-96"></a><span>       </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#ExpressionMap"><span class="hs-identifier hs-type">ExpressionMap</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#ExpressionDiff"><span class="hs-identifier hs-type">ExpressionDiff</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a><span>
</span><a name="line-97"></a><a name="toRecursiveSimplification"><a href="HashedExpression.Internal.Normalize.html#toRecursiveSimplification"><span class="hs-identifier">toRecursiveSimplification</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#toTransformation"><span class="hs-identifier hs-var">toTransformation</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#toRecursive"><span class="hs-identifier hs-var">toRecursive</span></a><span> </span><a href="HashedExpression.Internal.Inner.html#Reorder"><span class="hs-identifier hs-var">Reorder</span></a><span>
</span><a name="line-98"></a><span>
</span><a name="line-99"></a><span class="hs-comment">-- | Turn to multiplication if possible (i.e, scale a scalar R or Covector,</span><span>
</span><a name="line-100"></a><span class="hs-comment">-- inner product between 2 scalar R or Covector) (this is performed after all other rules completed)</span><span>
</span><a name="line-101"></a><span class="hs-comment">--</span><span>
</span><a name="line-102"></a><span class="hs-identifier">toMultiplyIfPossible</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a><span>
</span><a name="line-103"></a><a name="toMultiplyIfPossible"><a href="HashedExpression.Internal.Normalize.html#toMultiplyIfPossible"><span class="hs-identifier">toMultiplyIfPossible</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Normalize.html#toRecursiveSimplification"><span class="hs-identifier hs-var">toRecursiveSimplification</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#fromModification"><span class="hs-identifier hs-var">fromModification</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403656"><span class="hs-identifier hs-var">rule</span></a><span>
</span><a name="line-104"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-105"></a><span>    </span><a name="local-6989586621679403656"><a href="#local-6989586621679403656"><span class="hs-identifier">rule</span></a></a><span> </span><a name="local-6989586621679403657"><a href="#local-6989586621679403657"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403658"><a href="#local-6989586621679403658"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403659"><a href="#local-6989586621679403659"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><a name="local-6989586621679403660"><a href="#local-6989586621679403660"><span class="hs-identifier">et</span></a></a><span> </span><a name="local-6989586621679403661"><a href="#local-6989586621679403661"><span class="hs-identifier">scalar</span></a></a><span> </span><a name="local-6989586621679403662"><a href="#local-6989586621679403662"><span class="hs-identifier">scalee</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403659"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403658"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-107"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403660"><span class="hs-identifier hs-var">et</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="HashedExpression.Internal.Expression.html#C"><span class="hs-identifier hs-var">C</span></a><span>
</span><a name="line-108"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Utils.html#isScalarShape"><span class="hs-identifier hs-var">isScalarShape</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679403662"><span class="hs-identifier hs-var">scalee</span></a><span> </span><a href="#local-6989586621679403658"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403661"><span class="hs-identifier hs-var">scalar</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403662"><span class="hs-identifier hs-var">scalee</span></a><span>
</span><a name="line-109"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#InnerProd"><span class="hs-identifier hs-var">InnerProd</span></a><span> </span><a name="local-6989586621679403663"><a href="#local-6989586621679403663"><span class="hs-identifier">et</span></a></a><span> </span><a name="local-6989586621679403664"><a href="#local-6989586621679403664"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621679403665"><a href="#local-6989586621679403665"><span class="hs-identifier">arg2</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403659"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403658"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-110"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Utils.html#isScalarShape"><span class="hs-identifier hs-var">isScalarShape</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679403664"><span class="hs-identifier hs-var">arg1</span></a><span> </span><a href="#local-6989586621679403658"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Utils.html#isScalarShape"><span class="hs-identifier hs-var">isScalarShape</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679403665"><span class="hs-identifier hs-var">arg2</span></a><span> </span><a href="#local-6989586621679403658"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403663"><span class="hs-identifier hs-var">et</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="HashedExpression.Internal.Expression.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403664"><span class="hs-identifier hs-var">arg1</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403665"><span class="hs-identifier hs-var">arg2</span></a><span>
</span><a name="line-113"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403659"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-comment">-- | Equivalent version of toMultiplyIfPossible, but slower. Though I think it doesn't really matter which one we choose.</span><span>
</span><a name="line-116"></a><span class="hs-comment">--</span><span>
</span><a name="line-117"></a><span class="hs-identifier">toMultiplyIfPossible1</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a><span>
</span><a name="line-118"></a><a name="toMultiplyIfPossible1"><a href="HashedExpression.Internal.Normalize.html#toMultiplyIfPossible1"><span class="hs-identifier">toMultiplyIfPossible1</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-119"></a><span>    </span><a href="HashedExpression.Internal.Utils.html#chain"><span class="hs-identifier hs-var">chain</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Normalize.html#toRecursiveSimplification"><span class="hs-identifier hs-var">toRecursiveSimplification</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Pattern.html#fromSubstitution"><span class="hs-identifier hs-var">fromSubstitution</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-121"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-123"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-124"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-125"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-identifier">rulesFromPattern</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Transformation"><span class="hs-identifier hs-type">Transformation</span></a><span>
</span><a name="line-129"></a><a name="rulesFromPattern"><a href="HashedExpression.Internal.Normalize.html#rulesFromPattern"><span class="hs-identifier">rulesFromPattern</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-130"></a><span>    </span><a href="HashedExpression.Internal.Utils.html#chain"><span class="hs-identifier hs-var">chain</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Normalize.html#toRecursiveSimplification"><span class="hs-identifier hs-var">toRecursiveSimplification</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Pattern.html#fromSubstitution"><span class="hs-identifier hs-var">fromSubstitution</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">concat</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Normalize.html#complexNumRules"><span class="hs-identifier hs-var">complexNumRules</span></a><span>
</span><a name="line-132"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#zeroOneRules"><span class="hs-identifier hs-var">zeroOneRules</span></a><span>
</span><a name="line-133"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#scaleRules"><span class="hs-identifier hs-var">scaleRules</span></a><span>
</span><a name="line-134"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#dotProductRules"><span class="hs-identifier hs-var">dotProductRules</span></a><span>
</span><a name="line-135"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#distributiveRules"><span class="hs-identifier hs-var">distributiveRules</span></a><span>
</span><a name="line-136"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#piecewiseRules"><span class="hs-identifier hs-var">piecewiseRules</span></a><span>
</span><a name="line-137"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#exponentRules"><span class="hs-identifier hs-var">exponentRules</span></a><span>
</span><a name="line-138"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#rotateRules"><span class="hs-identifier hs-var">rotateRules</span></a><span>
</span><a name="line-139"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#fourierTransformRules"><span class="hs-identifier hs-var">fourierTransformRules</span></a><span>
</span><a name="line-140"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Normalize.html#otherRules"><span class="hs-identifier hs-var">otherRules</span></a><span>
</span><a name="line-141"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-142"></a><span>
</span><a name="line-143"></a><span class="hs-comment">-- | Rules with zero and one</span><span>
</span><a name="line-144"></a><span class="hs-comment">--</span><span>
</span><a name="line-145"></a><span class="hs-identifier">zeroOneRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-146"></a><a name="zeroOneRules"><a href="HashedExpression.Internal.Normalize.html#zeroOneRules"><span class="hs-identifier">zeroOneRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-147"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Pattern.html#one"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-148"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#one"><span class="hs-identifier hs-var">one</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-149"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#one"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-150"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#powerZero"><span class="hs-identifier hs-var">powerZero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#one"><span class="hs-identifier hs-var">one</span></a><span>
</span><a name="line-151"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#powerOne"><span class="hs-identifier hs-var">powerOne</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-152"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-153"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isComplex"><span class="hs-identifier hs-var">isComplex</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-156"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-157"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#one"><span class="hs-identifier hs-var">one</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-158"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-159"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-160"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#scalarZero"><span class="hs-identifier hs-var">scalarZero</span></a><span>
</span><a name="line-161"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#scalarZero"><span class="hs-identifier hs-var">scalarZero</span></a><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-identifier">scaleRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-165"></a><a name="scaleRules"><a href="HashedExpression.Internal.Normalize.html#scaleRules"><span class="hs-identifier">scaleRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sameElementType"><span class="hs-identifier hs-var">sameElementType</span></a><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">]</span><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span>
</span><a name="line-167"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-168"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#xRe"><span class="hs-identifier hs-var">xRe</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#xRe"><span class="hs-identifier hs-var">xRe</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-169"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#xIm"><span class="hs-identifier hs-var">xIm</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#xIm"><span class="hs-identifier hs-var">xIm</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-170"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#restOfProduct"><span class="hs-identifier hs-var">restOfProduct</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#restOfProduct"><span class="hs-identifier hs-var">restOfProduct</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-172"></a><span>
</span><a name="line-173"></a><span class="hs-comment">-- | Rules with complex operation</span><span>
</span><a name="line-174"></a><span class="hs-comment">--</span><span>
</span><a name="line-175"></a><span class="hs-identifier">complexNumRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-176"></a><a name="complexNumRules"><a href="HashedExpression.Internal.Normalize.html#complexNumRules"><span class="hs-identifier">complexNumRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Expression.html#xRe"><span class="hs-identifier hs-var">xRe</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-178"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#xIm"><span class="hs-identifier hs-var">xIm</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-179"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#u"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#v"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#u"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#v"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span>
</span><a name="line-180"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-183"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-184"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#restOfProduct"><span class="hs-identifier hs-var">restOfProduct</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#restOfProduct"><span class="hs-identifier hs-var">restOfProduct</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span>
</span><a name="line-185"></a><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#restOfSum"><span class="hs-identifier hs-var">restOfSum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2B"><span class="hs-operator hs-var">~+</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2B"><span class="hs-operator hs-var">~+</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#u"><span class="hs-identifier hs-var">u</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#v"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#restOfSum"><span class="hs-identifier hs-var">restOfSum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2B"><span class="hs-operator hs-var">~+</span></a><span>
</span><a name="line-187"></a><span>      </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#u"><span class="hs-identifier hs-var">u</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#v"><span class="hs-identifier hs-var">v</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#w"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-comment">-- | Rules with dot product and scale</span><span>
</span><a name="line-193"></a><span class="hs-comment">--</span><span>
</span><a name="line-194"></a><span class="hs-identifier">dotProductRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-195"></a><a name="dotProductRules"><a href="HashedExpression.Internal.Normalize.html#dotProductRules"><span class="hs-identifier">dotProductRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-196"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">--</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#t"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#z"><span class="hs-identifier hs-var">z</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="HashedExpression.Internal.Pattern.html#t"><span class="hs-identifier hs-var">t</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Conjugate if the scalar is complex</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isScalar"><span class="hs-identifier hs-var">isScalar</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%26%26."><span class="hs-operator hs-var">&amp;&amp;.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span>
</span><a name="line-201"></a><span>      </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-203"></a><span>
</span><a name="line-204"></a><span class="hs-comment">-- | Rules of distributive over sum</span><span>
</span><a name="line-205"></a><span class="hs-comment">--</span><span>
</span><a name="line-206"></a><span class="hs-identifier">distributiveRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-207"></a><a name="distributiveRules"><a href="HashedExpression.Internal.Normalize.html#distributiveRules"><span class="hs-identifier">distributiveRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">*</span><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#restOfProduct"><span class="hs-identifier hs-var">restOfProduct</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#restOfProduct"><span class="hs-identifier hs-var">restOfProduct</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~%2A"><span class="hs-operator hs-var">~*</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-215"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#ys"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-216"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- | Fourier transform rules</span><span>
</span><a name="line-219"></a><span class="hs-comment">--</span><span>
</span><a name="line-220"></a><span class="hs-identifier">fourierTransformRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-221"></a><a name="fourierTransformRules"><a href="HashedExpression.Internal.Normalize.html#fourierTransformRules"><span class="hs-identifier">fourierTransformRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-222"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-226"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#twiceImFT"><span class="hs-identifier hs-var">twiceImFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#twiceReFT"><span class="hs-identifier hs-var">twiceReFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-228"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-229"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-230"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-231"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-232"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-233"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-235"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-236"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-237"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isCovector"><span class="hs-identifier hs-var">isCovector</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-238"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#reFT"><span class="hs-identifier hs-var">reFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#twiceReFT"><span class="hs-identifier hs-var">twiceReFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-239"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#imFT"><span class="hs-identifier hs-var">imFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#isReal"><span class="hs-identifier hs-var">isReal</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#twiceImFT"><span class="hs-identifier hs-var">twiceImFT</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-240"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span class="hs-comment">-- | Rules of piecewise</span><span>
</span><a name="line-243"></a><span class="hs-comment">--</span><span>
</span><a name="line-244"></a><span class="hs-identifier">piecewiseRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-245"></a><a name="piecewiseRules"><a href="HashedExpression.Internal.Normalize.html#piecewiseRules"><span class="hs-identifier">piecewiseRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-246"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Pattern.html#piecewise_"><span class="hs-identifier hs-var">piecewise_</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#condition"><span class="hs-identifier hs-var">condition</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#branches"><span class="hs-identifier hs-var">branches</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#allTheSame"><span class="hs-identifier hs-var">allTheSame</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#branches"><span class="hs-identifier hs-var">branches</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span>
</span><a name="line-247"></a><span>      </span><a href="HashedExpression.Internal.Pattern.html#headL"><span class="hs-identifier hs-var">headL</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#branches"><span class="hs-identifier hs-var">branches</span></a><span>
</span><a name="line-248"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-comment">-- | Rules of exponent and log</span><span>
</span><a name="line-251"></a><span class="hs-comment">--</span><span>
</span><a name="line-252"></a><span class="hs-identifier">exponentRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-253"></a><a name="exponentRules"><a href="HashedExpression.Internal.Normalize.html#exponentRules"><span class="hs-identifier">exponentRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-254"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">exp</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">log</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-comment">--</span><span>
</span><a name="line-255"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">log</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">exp</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-comment">--</span><span>
</span><a name="line-256"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">exp</span><span> </span><a href="HashedExpression.Internal.Pattern.html#zero"><span class="hs-identifier hs-var">zero</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#one"><span class="hs-identifier hs-var">one</span></a><span>
</span><a name="line-257"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-260"></a><span class="hs-comment">--</span><span>
</span><a name="line-261"></a><span class="hs-identifier">otherRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-262"></a><a name="otherRules"><a href="HashedExpression.Internal.Normalize.html#otherRules"><span class="hs-identifier">otherRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-263"></a><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">negate</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#scalar"><span class="hs-identifier hs-var">scalar</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-comment">--</span><span>
</span><a name="line-264"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#alpha"><span class="hs-identifier hs-var">alpha</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#beta"><span class="hs-identifier hs-var">beta</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#alpha"><span class="hs-identifier hs-var">alpha</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="HashedExpression.Internal.Pattern.html#beta"><span class="hs-identifier hs-var">beta</span></a><span class="hs-special">)</span><span>
</span><a name="line-265"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-266"></a><span>
</span><a name="line-267"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-268"></a><span class="hs-comment">--</span><span>
</span><a name="line-269"></a><span class="hs-identifier">rotateRules</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="HashedExpression.Internal.Pattern.html#Substitution"><span class="hs-identifier hs-type">Substitution</span></a><span class="hs-special">]</span><span>
</span><a name="line-270"></a><a name="rotateRules"><a href="HashedExpression.Internal.Normalize.html#rotateRules"><span class="hs-identifier">rotateRules</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-271"></a><span>    </span><span class="hs-special">[</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#s"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-272"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount1"><span class="hs-identifier hs-var">amount1</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount2"><span class="hs-identifier hs-var">amount2</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#amount1"><span class="hs-identifier hs-var">amount1</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><a href="HashedExpression.Internal.Pattern.html#amount2"><span class="hs-identifier hs-var">amount2</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-273"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#zeroAmount"><span class="hs-identifier hs-var">zeroAmount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-274"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sum"><span class="hs-identifier hs-var">sum</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#product"><span class="hs-identifier hs-var">product</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#product"><span class="hs-identifier hs-var">product</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#mapL"><span class="hs-identifier hs-var">mapL</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#xs"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C.~~~~~~%3E"><span class="hs-operator hs-var">|.~~~~~~&gt;</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount"><span class="hs-identifier hs-var">amount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-277"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount1"><span class="hs-identifier hs-var">amount1</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount2"><span class="hs-identifier hs-var">amount2</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#%7C."><span class="hs-operator hs-var">|.</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#sameAmount"><span class="hs-identifier hs-var">sameAmount</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount1"><span class="hs-identifier hs-var">amount1</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#amount2"><span class="hs-identifier hs-var">amount2</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#~~~~~~%3E"><span class="hs-operator hs-var">~~~~~~&gt;</span></a><span>
</span><a name="line-278"></a><span>      </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Pattern.html#x"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a><span> </span><a href="HashedExpression.Internal.Pattern.html#y"><span class="hs-identifier hs-var">y</span></a><span class="hs-special">)</span><span>
</span><a name="line-279"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-280"></a><span>
</span><a name="line-281"></a><span class="hs-comment">-- | 1 and 0 rules for Sum and Mul since they can involve many operands</span><span>
</span><a name="line-282"></a><span class="hs-comment">--</span><span>
</span><a name="line-283"></a><span class="hs-identifier">zeroOneSumProdRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-284"></a><a name="zeroOneSumProdRules"><a href="HashedExpression.Internal.Normalize.html#zeroOneSumProdRules"><span class="hs-identifier">zeroOneSumProdRules</span></a></a><span> </span><a name="local-6989586621679403666"><a href="#local-6989586621679403666"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403667"><a href="#local-6989586621679403667"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403668"><a href="#local-6989586621679403668"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-285"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403668"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-286"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403669"><a href="#local-6989586621679403669"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-287"></a><span>                </span><span class="hs-comment">-- to make sure filter (not . isZero mp) ns is not empty</span><span>
</span><a name="line-288"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#isZero"><span class="hs-identifier hs-var">isZero</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679403669"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679403669"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-289"></a><span>                </span><span class="hs-comment">-- if the sum has any zero, remove them</span><span>
</span><a name="line-290"></a><span>                </span><span class="hs-comment">-- sum(x, y, z, 0, t, 0) = sum(x, y, z, t)</span><span>
</span><a name="line-291"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#isZero"><span class="hs-identifier hs-var">isZero</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679403669"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-292"></a><span>                </span><a href="HashedExpression.Internal.Inner.html#sum_"><span class="hs-identifier hs-var">sum_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Utils.html#isZero"><span class="hs-identifier hs-var">isZero</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403669"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-293"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403670"><a href="#local-6989586621679403670"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-294"></a><span>                </span><span class="hs-comment">-- to make sure filter (not . isOne mp) ns is not empty</span><span>
</span><a name="line-295"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">all</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#isOne"><span class="hs-identifier hs-var">isOne</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-296"></a><span>                </span><span class="hs-comment">-- if the product has any one, remove them</span><span>
</span><a name="line-297"></a><span>                </span><span class="hs-comment">-- product(x, y, z, 1, t, 1) = product(x, y, z, t)</span><span>
</span><a name="line-298"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#isOne"><span class="hs-identifier hs-var">isOne</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-299"></a><span>                </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Utils.html#isOne"><span class="hs-identifier hs-var">isOne</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-300"></a><span>                </span><span class="hs-comment">-- if any is zero, collapse to zero</span><span>
</span><a name="line-301"></a><span>                </span><span class="hs-comment">-- product(x, y, z, 0, t, u, v) = 0</span><span>
</span><a name="line-302"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679403671"><a href="#local-6989586621679403671"><span class="hs-identifier">nId</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#isZero"><span class="hs-identifier hs-var">isZero</span></a><span> </span><a href="#local-6989586621679403667"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679403670"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403671"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-303"></a><span>                </span><span class="hs-comment">-- if the prod contains any prod, just flatten them out</span><span>
</span><a name="line-304"></a><span>                </span><span class="hs-comment">-- product(x, product(y, z), product(t, u, v)) = product(x, y, z, t, u, v)</span><span>
</span><a name="line-305"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403668"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-308"></a><span class="hs-comment">--</span><span>
</span><a name="line-309"></a><span class="hs-identifier">collapseSumProdRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-310"></a><a name="collapseSumProdRules"><a href="HashedExpression.Internal.Normalize.html#collapseSumProdRules"><span class="hs-identifier">collapseSumProdRules</span></a></a><span> </span><a name="local-6989586621679403672"><a href="#local-6989586621679403672"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403673"><a href="#local-6989586621679403673"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403674"><a href="#local-6989586621679403674"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-311"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403674"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403673"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-312"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403675"><a href="#local-6989586621679403675"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-313"></a><span>                </span><span class="hs-comment">-- if the sum has only one, collapse it</span><span>
</span><a name="line-314"></a><span>                </span><span class="hs-comment">-- sum(x) -&gt; x</span><span>
</span><a name="line-315"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679403675"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679403675"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-316"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403676"><a href="#local-6989586621679403676"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-317"></a><span>                </span><span class="hs-comment">-- if the mul has only one, collapse it</span><span>
</span><a name="line-318"></a><span>                </span><span class="hs-comment">-- product(x) -&gt; x</span><span>
</span><a name="line-319"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679403676"><span class="hs-identifier hs-var">ns</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679403676"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-320"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403674"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-comment">-- | If sum or product contains sub-sum or sub-product, flatten them out</span><span>
</span><a name="line-323"></a><span class="hs-comment">--</span><span>
</span><a name="line-324"></a><span class="hs-identifier">flattenSumProdRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-325"></a><a name="flattenSumProdRules"><a href="HashedExpression.Internal.Normalize.html#flattenSumProdRules"><span class="hs-identifier">flattenSumProdRules</span></a></a><span> </span><a name="local-6989586621679403677"><a href="#local-6989586621679403677"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403678"><a href="#local-6989586621679403678"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403679"><a href="#local-6989586621679403679"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-326"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403679"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403678"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-327"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403680"><a href="#local-6989586621679403680"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-328"></a><span>        </span><span class="hs-comment">-- if the sum contains any sum, just flatten them out</span><span>
</span><a name="line-329"></a><span>        </span><span class="hs-comment">-- sum(x, sum(y, z), sum(t, u, v)) = sum(x, y, z, t, u, v)</span><span>
</span><a name="line-330"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#sum_"><span class="hs-identifier hs-var">sum_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#pullSumOperands"><span class="hs-identifier hs-var">pullSumOperands</span></a><span> </span><a href="#local-6989586621679403678"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403680"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-331"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403681"><a href="#local-6989586621679403681"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-332"></a><span>        </span><span class="hs-comment">-- if the prod contains any prod, just flatten them out</span><span>
</span><a name="line-333"></a><span>        </span><span class="hs-comment">-- product(x, product(y, z), product(t, u, v)) = product(x, y, z, t, u, v)</span><span>
</span><a name="line-334"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">concatMap</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Utils.html#pullProdOperands"><span class="hs-identifier hs-var">pullProdOperands</span></a><span> </span><a href="#local-6989586621679403678"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403681"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-335"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403679"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-336"></a><span>
</span><a name="line-337"></a><span class="hs-comment">-- | If there are more than one constant in a sum or a product, group them together</span><span>
</span><a name="line-338"></a><span class="hs-comment">--</span><span>
</span><a name="line-339"></a><span class="hs-identifier">groupConstantsRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-340"></a><a name="groupConstantsRules"><a href="HashedExpression.Internal.Normalize.html#groupConstantsRules"><span class="hs-identifier">groupConstantsRules</span></a></a><span> </span><a name="local-6989586621679403682"><a href="#local-6989586621679403682"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403683"><a href="#local-6989586621679403683"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403684"><a href="#local-6989586621679403684"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-341"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679403685"><a href="#local-6989586621679403685"><span class="hs-identifier">shape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679403684"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-342"></a><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403684"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-343"></a><span>            </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403686"><a href="#local-6989586621679403686"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-344"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679403687"><a href="#local-6989586621679403687"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Utils.html#pullConstants"><span class="hs-identifier hs-var">pullConstants</span></a><span> </span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">mp</span></a><span> </span><a href="#local-6989586621679403686"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-345"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679403687"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-346"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679403688"><a href="#local-6989586621679403688"><span class="hs-identifier">total</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#const_"><span class="hs-identifier hs-var">const_</span></a><span> </span><a href="#local-6989586621679403685"><span class="hs-identifier hs-var">shape</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Prelude.sum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403687"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-347"></a><span>                    </span><a href="HashedExpression.Internal.Inner.html#sum_"><span class="hs-identifier hs-var">sum_</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-348"></a><span>                    </span><a href="#local-6989586621679403688"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Utils.html#isConstant"><span class="hs-identifier hs-var">isConstant</span></a><span> </span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403686"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-349"></a><span>            </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403689"><a href="#local-6989586621679403689"><span class="hs-identifier">ns</span></a></a><span>
</span><a name="line-350"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679403690"><a href="#local-6989586621679403690"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Utils.html#pullConstants"><span class="hs-identifier hs-var">pullConstants</span></a><span> </span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">mp</span></a><span> </span><a href="#local-6989586621679403689"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-351"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679403690"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-352"></a><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679403691"><a href="#local-6989586621679403691"><span class="hs-identifier">total</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#const_"><span class="hs-identifier hs-var">const_</span></a><span> </span><a href="#local-6989586621679403685"><span class="hs-identifier hs-var">shape</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Prelude.product</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403690"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-353"></a><span>                    </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-354"></a><span>                    </span><a href="#local-6989586621679403691"><span class="hs-identifier hs-var">total</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Utils.html#isConstant"><span class="hs-identifier hs-var">isConstant</span></a><span> </span><a href="#local-6989586621679403683"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403689"><span class="hs-identifier hs-var">ns</span></a><span class="hs-special">)</span><span>
</span><a name="line-355"></a><span>            </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403684"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-358"></a><span class="hs-comment">--</span><span>
</span><a name="line-359"></a><span class="hs-comment">-- Sum(x,(-1) *. x,y) -&gt; Sum(y)</span><span>
</span><a name="line-360"></a><span class="hs-comment">-- Sum(2 *. x, (-1) *. x,y) -&gt; Sum(x,y)</span><span>
</span><a name="line-361"></a><span class="hs-comment">-- Sum(x,x,y) -&gt; Sum(2 *. x,y)</span><span>
</span><a name="line-362"></a><span class="hs-identifier">combineTermsRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-363"></a><a name="combineTermsRules"><a href="HashedExpression.Internal.Normalize.html#combineTermsRules"><span class="hs-identifier">combineTermsRules</span></a></a><span> </span><a name="local-6989586621679403692"><a href="#local-6989586621679403692"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403693"><a href="#local-6989586621679403693"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403694"><a href="#local-6989586621679403694"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-364"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403710"><a href="#local-6989586621679403710"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403694"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-365"></a><span>        </span><a href="HashedExpression.Internal.Inner.html#sum_"><span class="hs-identifier hs-var">sum_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403699"><span class="hs-identifier hs-var">toDiff</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679403697"><span class="hs-identifier hs-var">combine</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><a href="#local-6989586621679403698"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679403696"><span class="hs-identifier hs-var">cntAppr</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-366"></a><span>        </span><a href="#local-6989586621679403710"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-367"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403694"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-368"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-369"></a><span>    </span><a name="local-6989586621679403695"><a href="#local-6989586621679403695"><span class="hs-identifier">applyDiff'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#applyDiff"><span class="hs-identifier hs-var">applyDiff</span></a><span> </span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-370"></a><span>    </span><a name="local-6989586621679403696"><a href="#local-6989586621679403696"><span class="hs-identifier">cntAppr</span></a></a><span> </span><a name="local-6989586621679403700"><a href="#local-6989586621679403700"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-371"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403701"><a href="#local-6989586621679403701"><span class="hs-identifier">scalerN</span></a></a><span> </span><a name="local-6989586621679403702"><a href="#local-6989586621679403702"><span class="hs-identifier">scaleeN</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403700"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-372"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Const"><span class="hs-identifier hs-var">Const</span></a><span> </span><a name="local-6989586621679403703"><a href="#local-6989586621679403703"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403701"><span class="hs-identifier hs-var">scalerN</span></a><span> </span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403702"><span class="hs-identifier hs-var">scaleeN</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403703"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Neg"><span class="hs-identifier hs-var">Neg</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403704"><a href="#local-6989586621679403704"><span class="hs-identifier">negateeN</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403700"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403693"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403704"><span class="hs-identifier hs-var">negateeN</span></a><span class="hs-special">,</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-374"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403700"><span class="hs-identifier hs-var">nId</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-375"></a><span>    </span><a name="local-6989586621679403697"><a href="#local-6989586621679403697"><span class="hs-identifier">combine</span></a></a><span> </span><a name="local-6989586621679403705"><a href="#local-6989586621679403705"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679403705"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Prelude.sum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679403705"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>    </span><a name="local-6989586621679403698"><a href="#local-6989586621679403698"><span class="hs-identifier">fn</span></a></a><span> </span><a name="local-6989586621679403706"><a href="#local-6989586621679403706"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679403707"><a href="#local-6989586621679403707"><span class="hs-identifier">y</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679403706"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679403707"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-377"></a><span>    </span><span class="hs-identifier">toDiff</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Double</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#Change"><span class="hs-identifier hs-type">Change</span></a><span>
</span><a name="line-378"></a><span>    </span><a name="local-6989586621679403699"><a href="#local-6989586621679403699"><span class="hs-identifier">toDiff</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679403708"><a href="#local-6989586621679403708"><span class="hs-identifier">nId</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403709"><a href="#local-6989586621679403709"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-379"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679403709"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403708"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-380"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#num_"><span class="hs-identifier hs-var">num_</span></a><span> </span><a href="#local-6989586621679403709"><span class="hs-identifier hs-var">val</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403708"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-381"></a><span>
</span><a name="line-382"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-383"></a><span class="hs-comment">--</span><span>
</span><a name="line-384"></a><span class="hs-comment">-- Mul(x^(-1) * x,y) -&gt; y</span><span>
</span><a name="line-385"></a><span class="hs-comment">-- Mul(x,x,y) -&gt; Mul(x^2,y), but we don't group Sum or Complex</span><span>
</span><a name="line-386"></a><span class="hs-identifier">combineTermsRulesProd</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-387"></a><a name="combineTermsRulesProd"><a href="HashedExpression.Internal.Normalize.html#combineTermsRulesProd"><span class="hs-identifier">combineTermsRulesProd</span></a></a><span> </span><a name="local-6989586621679403711"><a href="#local-6989586621679403711"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403712"><a href="#local-6989586621679403712"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403713"><a href="#local-6989586621679403713"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-388"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403729"><a href="#local-6989586621679403729"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403713"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-389"></a><span>        </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-390"></a><span>        </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403718"><span class="hs-identifier hs-var">toDiff</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679403716"><span class="hs-identifier hs-var">combine</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">groupBy</span><span> </span><a href="#local-6989586621679403717"><span class="hs-identifier hs-var">fn</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">sortWith</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679403715"><span class="hs-identifier hs-var">cntAppr</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-391"></a><span>        </span><a href="#local-6989586621679403729"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-392"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403713"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-393"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-394"></a><span>    </span><a name="local-6989586621679403714"><a href="#local-6989586621679403714"><span class="hs-identifier">applyDiff'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#applyDiff"><span class="hs-identifier hs-var">applyDiff</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-395"></a><span>    </span><a name="local-6989586621679403715"><a href="#local-6989586621679403715"><span class="hs-identifier">cntAppr</span></a></a><span> </span><a name="local-6989586621679403719"><a href="#local-6989586621679403719"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-396"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679403720"><a href="#local-6989586621679403720"><span class="hs-identifier">value</span></a></a><span> </span><a name="local-6989586621679403721"><a href="#local-6989586621679403721"><span class="hs-identifier">powerel</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403719"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403721"><span class="hs-identifier hs-var">powerel</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403720"><span class="hs-identifier hs-var">value</span></a><span class="hs-special">)</span><span>
</span><a name="line-397"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403719"><span class="hs-identifier hs-var">nId</span></a><span class="hs-special">,</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-398"></a><span>    </span><a name="local-6989586621679403716"><a href="#local-6989586621679403716"><span class="hs-identifier">combine</span></a></a><span> </span><a name="local-6989586621679403722"><a href="#local-6989586621679403722"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><a href="#local-6989586621679403722"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Prelude.sum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679403722"><span class="hs-identifier hs-var">xs</span></a><span class="hs-special">)</span><span>
</span><a name="line-399"></a><span>    </span><a name="local-6989586621679403717"><a href="#local-6989586621679403717"><span class="hs-identifier">fn</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679403723"><a href="#local-6989586621679403723"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403724"><a href="#local-6989586621679403724"><span class="hs-identifier">px</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679403725"><a href="#local-6989586621679403725"><span class="hs-identifier">y</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403726"><a href="#local-6989586621679403726"><span class="hs-identifier">py</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-400"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403723"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-401"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403725"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-402"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveElementType"><span class="hs-identifier hs-var">retrieveElementType</span></a><span> </span><a href="#local-6989586621679403723"><span class="hs-identifier hs-var">x</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-403"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#C"><span class="hs-identifier hs-var">C</span></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveElementType"><span class="hs-identifier hs-var">retrieveElementType</span></a><span> </span><a href="#local-6989586621679403725"><span class="hs-identifier hs-var">y</span></a><span> </span><a href="#local-6989586621679403712"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-404"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679403723"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679403725"><span class="hs-identifier hs-var">y</span></a><span>
</span><a name="line-405"></a><span>    </span><a name="local-6989586621679403718"><a href="#local-6989586621679403718"><span class="hs-identifier">toDiff</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679403727"><a href="#local-6989586621679403727"><span class="hs-identifier">nId</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403728"><a href="#local-6989586621679403728"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-406"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679403728"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403727"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-407"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403727"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679403728"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-408"></a><span>
</span><a name="line-409"></a><span class="hs-comment">-- | Rules for combining powers of power</span><span>
</span><a name="line-410"></a><span class="hs-comment">-- (x^2)^3 -&gt; x^6</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- (x^2)^-1 -&gt; x^-2</span><span>
</span><a name="line-412"></a><span class="hs-identifier">combinePowerRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-413"></a><a name="combinePowerRules"><a href="HashedExpression.Internal.Normalize.html#combinePowerRules"><span class="hs-identifier">combinePowerRules</span></a></a><span> </span><a name="local-6989586621679403730"><a href="#local-6989586621679403730"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403731"><a href="#local-6989586621679403731"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403732"><a href="#local-6989586621679403732"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-414"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679403733"><a href="#local-6989586621679403733"><span class="hs-identifier">outerVal</span></a></a><span> </span><a name="local-6989586621679403734"><a href="#local-6989586621679403734"><span class="hs-identifier">outerN</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403732"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403731"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-415"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679403735"><a href="#local-6989586621679403735"><span class="hs-identifier">innerVal</span></a></a><span> </span><a name="local-6989586621679403736"><a href="#local-6989586621679403736"><span class="hs-identifier">innerN</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403734"><span class="hs-identifier hs-var">outerN</span></a><span> </span><a href="#local-6989586621679403731"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-416"></a><span>        </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403736"><span class="hs-identifier hs-var">innerN</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403733"><span class="hs-identifier hs-var">outerVal</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679403735"><span class="hs-identifier hs-var">innerVal</span></a><span class="hs-special">)</span><span>
</span><a name="line-417"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403732"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-418"></a><span>
</span><a name="line-419"></a><span class="hs-comment">-- | Rules for power of Sum and power of RealImag</span><span>
</span><a name="line-420"></a><span class="hs-comment">-- (a+b)^2 should be (a+b)*(a+b)</span><span>
</span><a name="line-421"></a><span class="hs-comment">-- (a +: b) ^ 2 should be (a +: b) * (a +: b)</span><span>
</span><a name="line-422"></a><span class="hs-identifier">powerSumRealImagRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-423"></a><a name="powerSumRealImagRules"><a href="HashedExpression.Internal.Normalize.html#powerSumRealImagRules"><span class="hs-identifier">powerSumRealImagRules</span></a></a><span> </span><a name="local-6989586621679403737"><a href="#local-6989586621679403737"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403738"><a href="#local-6989586621679403738"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403739"><a href="#local-6989586621679403739"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-424"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679403745"><a href="#local-6989586621679403745"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679403746"><a href="#local-6989586621679403746"><span class="hs-identifier">nId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403739"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403738"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-425"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403740"><span class="hs-identifier hs-var">isSumOrRealImag</span></a><span> </span><a href="#local-6989586621679403746"><span class="hs-identifier hs-var">nId</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679403741"><span class="hs-identifier hs-var">replicateMul</span></a><span> </span><a href="#local-6989586621679403745"><span class="hs-identifier hs-var">val</span></a><span> </span><a href="#local-6989586621679403746"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-426"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403739"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-427"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-428"></a><span>    </span><a name="local-6989586621679403740"><a href="#local-6989586621679403740"><span class="hs-identifier">isSumOrRealImag</span></a></a><span> </span><a name="local-6989586621679403742"><a href="#local-6989586621679403742"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-429"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403742"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403738"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-430"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#RealImag"><span class="hs-identifier hs-var">RealImag</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403742"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403738"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-431"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-432"></a><span>    </span><a name="local-6989586621679403741"><a href="#local-6989586621679403741"><span class="hs-identifier">replicateMul</span></a></a><span> </span><a name="local-6989586621679403743"><a href="#local-6989586621679403743"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679403744"><a href="#local-6989586621679403744"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-433"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679403743"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679403743"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403744"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-434"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679403743"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621679403743"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403744"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-435"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403744"><span class="hs-identifier hs-var">nId</span></a><span>
</span><a name="line-436"></a><span>
</span><a name="line-437"></a><span class="hs-comment">-- | Rules for power product</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- (a*b*c)^k should be a^k * b^k * c^k</span><span>
</span><a name="line-439"></a><span class="hs-identifier">powerProdRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-440"></a><a name="powerProdRules"><a href="HashedExpression.Internal.Normalize.html#powerProdRules"><span class="hs-identifier">powerProdRules</span></a></a><span> </span><a name="local-6989586621679403747"><a href="#local-6989586621679403747"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403748"><a href="#local-6989586621679403748"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403749"><a href="#local-6989586621679403749"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679403750"><a href="#local-6989586621679403750"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679403751"><a href="#local-6989586621679403751"><span class="hs-identifier">nId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403749"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403748"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-442"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403752"><a href="#local-6989586621679403752"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403751"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403748"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679403750"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403752"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-443"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403749"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-444"></a><span>
</span><a name="line-445"></a><span class="hs-comment">-- | Rules for power scale</span><span>
</span><a name="line-446"></a><span class="hs-comment">-- (a*.b)^2 should be a^2 *. b^2</span><span>
</span><a name="line-447"></a><span class="hs-identifier">powerScaleRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-448"></a><a name="powerScaleRules"><a href="HashedExpression.Internal.Normalize.html#powerScaleRules"><span class="hs-identifier">powerScaleRules</span></a></a><span> </span><a name="local-6989586621679403753"><a href="#local-6989586621679403753"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403754"><a href="#local-6989586621679403754"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403755"><a href="#local-6989586621679403755"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-449"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679403756"><a href="#local-6989586621679403756"><span class="hs-identifier">val</span></a></a><span> </span><a name="local-6989586621679403757"><a href="#local-6989586621679403757"><span class="hs-identifier">nId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403755"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403754"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-450"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><a name="local-6989586621679403758"><a href="#local-6989586621679403758"><span class="hs-identifier">et</span></a></a><span> </span><a name="local-6989586621679403759"><a href="#local-6989586621679403759"><span class="hs-identifier">scalar</span></a></a><span> </span><a name="local-6989586621679403760"><a href="#local-6989586621679403760"><span class="hs-identifier">scalee</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403757"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403754"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-451"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403756"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">&gt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403759"><span class="hs-identifier hs-var">scalar</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679403756"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403760"><span class="hs-identifier hs-var">scalee</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%5E"><span class="hs-operator hs-var">^</span></a><span> </span><a href="#local-6989586621679403756"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403755"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-453"></a><span>
</span><a name="line-454"></a><span class="hs-comment">-- | Rules for combining scalar</span><span>
</span><a name="line-455"></a><span class="hs-comment">-- (a *. x) * (b *. y) * (c *. z) --&gt; (a * b * c) *. (x * y * z) (if all are real)</span><span>
</span><a name="line-456"></a><span class="hs-comment">--</span><span>
</span><a name="line-457"></a><span class="hs-identifier">combineRealScalarRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-458"></a><a name="combineRealScalarRules"><a href="HashedExpression.Internal.Normalize.html#combineRealScalarRules"><span class="hs-identifier">combineRealScalarRules</span></a></a><span> </span><a name="local-6989586621679403761"><a href="#local-6989586621679403761"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403762"><a href="#local-6989586621679403762"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403763"><a href="#local-6989586621679403763"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-459"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><a name="local-6989586621679403769"><a href="#local-6989586621679403769"><span class="hs-identifier">ns</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403763"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403762"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-460"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679403770"><a href="#local-6989586621679403770"><span class="hs-identifier">extracted</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679403764"><span class="hs-identifier hs-var">extract</span></a><span> </span><a href="#local-6989586621679403769"><span class="hs-identifier hs-var">ns</span></a><span>
</span><a name="line-461"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">any</span><span> </span><span class="hs-identifier hs-var">isJust</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403770"><span class="hs-identifier hs-var">extracted</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-462"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679403771"><a href="#local-6989586621679403771"><span class="hs-identifier">combinedScalars</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">catMaybes</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><a href="#local-6989586621679403770"><span class="hs-identifier hs-var">extracted</span></a><span>
</span><a name="line-463"></a><span>            </span><a name="local-6989586621679403772"><a href="#local-6989586621679403772"><span class="hs-identifier">combinedScalees</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#product_"><span class="hs-identifier hs-var">product_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><a href="#local-6989586621679403770"><span class="hs-identifier hs-var">extracted</span></a><span>
</span><a name="line-464"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679403771"><span class="hs-identifier hs-var">combinedScalars</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="#local-6989586621679403772"><span class="hs-identifier hs-var">combinedScalees</span></a><span>
</span><a name="line-465"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403763"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-466"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-467"></a><span>    </span><a name="local-6989586621679403764"><a href="#local-6989586621679403764"><span class="hs-identifier">extract</span></a></a><span> </span><a name="local-6989586621679403765"><a href="#local-6989586621679403765"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-468"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679403766"><a href="#local-6989586621679403766"><span class="hs-identifier">scalar</span></a></a><span> </span><a name="local-6989586621679403767"><a href="#local-6989586621679403767"><span class="hs-identifier">scalee</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403765"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403762"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-469"></a><span>            </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403767"><span class="hs-identifier hs-var">scalee</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403766"><span class="hs-identifier hs-var">scalar</span></a><span class="hs-special">)</span><span>
</span><a name="line-470"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Neg"><span class="hs-identifier hs-var">Neg</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><a name="local-6989586621679403768"><a href="#local-6989586621679403768"><span class="hs-identifier">negatee</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403765"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403762"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-471"></a><span>            </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403768"><span class="hs-identifier hs-var">negatee</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Inner.html#num_"><span class="hs-identifier hs-var">num_</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-472"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403765"><span class="hs-identifier hs-var">nId</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span class="hs-special">)</span><span>
</span><a name="line-473"></a><span>
</span><a name="line-474"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-475"></a><span class="hs-comment">--</span><span>
</span><a name="line-476"></a><span class="hs-identifier">evaluateIfPossibleRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-477"></a><a name="evaluateIfPossibleRules"><a href="HashedExpression.Internal.Normalize.html#evaluateIfPossibleRules"><span class="hs-identifier">evaluateIfPossibleRules</span></a></a><span> </span><a name="local-6989586621679403773"><a href="#local-6989586621679403773"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679403774"><a href="#local-6989586621679403774"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403775"><a href="#local-6989586621679403775"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-478"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679403777"><span class="hs-identifier hs-var">node</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679403779"><span class="hs-identifier hs-var">pulledVals</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-479"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679404191"><a href="#local-6989586621679404191"><span class="hs-identifier">vals</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Prelude.sum</span><span> </span><a href="#local-6989586621679404191"><span class="hs-identifier hs-var">vals</span></a><span>
</span><a name="line-480"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#Mul"><span class="hs-identifier hs-var">Mul</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679404192"><a href="#local-6989586621679404192"><span class="hs-identifier">vals</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Prelude.product</span><span> </span><a href="#local-6989586621679404192"><span class="hs-identifier hs-var">vals</span></a><span>
</span><a name="line-481"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679404193"><a href="#local-6989586621679404193"><span class="hs-identifier">val1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404194"><a href="#local-6989586621679404194"><span class="hs-identifier">val2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679404193"><span class="hs-identifier hs-var">val1</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679404194"><span class="hs-identifier hs-var">val2</span></a><span>
</span><a name="line-482"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#Neg"><span class="hs-identifier hs-var">Neg</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679404195"><a href="#local-6989586621679404195"><span class="hs-identifier">val</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-483"></a><span>            </span><span class="hs-glyph">|</span><span> </span><a href="#local-6989586621679404195"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><a href="#local-6989586621679404195"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">)</span><span>
</span><a name="line-484"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-485"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#Power"><span class="hs-identifier hs-var">Power</span></a><span> </span><a name="local-6989586621679404196"><a href="#local-6989586621679404196"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679404197"><a href="#local-6989586621679404197"><span class="hs-identifier">val</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679404197"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">**</span><span> </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><a href="#local-6989586621679404196"><span class="hs-identifier hs-var">x</span></a><span>
</span><a name="line-486"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#InnerProd"><span class="hs-identifier hs-var">InnerProd</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><a name="local-6989586621679404198"><a href="#local-6989586621679404198"><span class="hs-identifier">arg1</span></a></a><span> </span><a name="local-6989586621679404199"><a href="#local-6989586621679404199"><span class="hs-identifier">arg2</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679404200"><a href="#local-6989586621679404200"><span class="hs-identifier">val1</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404201"><a href="#local-6989586621679404201"><span class="hs-identifier">val2</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-487"></a><span>            </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-488"></a><span>            </span><a href="#local-6989586621679404200"><span class="hs-identifier hs-var">val1</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679404201"><span class="hs-identifier hs-var">val2</span></a><span> </span><span class="hs-operator hs-var">*</span><span>
</span><a name="line-489"></a><span>            </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Prelude.product</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679404198"><span class="hs-identifier hs-var">arg1</span></a><span> </span><a href="#local-6989586621679403774"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span>
</span><a name="line-490"></a><span>        </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Expression.html#Rotate"><span class="hs-identifier hs-var">Rotate</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679404202"><a href="#local-6989586621679404202"><span class="hs-identifier">val</span></a></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679403780"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="#local-6989586621679404202"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-491"></a><span>        </span><span class="hs-comment">-- TODO: sin, sos, ...</span><span>
</span><a name="line-492"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679403775"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-493"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-494"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679403776"><a href="#local-6989586621679403776"><span class="hs-identifier">shape</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679403777"><a href="#local-6989586621679403777"><span class="hs-identifier">node</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveInternal"><span class="hs-identifier hs-var">retrieveInternal</span></a><span> </span><a href="#local-6989586621679403775"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679403774"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-495"></a><span>    </span><a name="local-6989586621679403778"><a href="#local-6989586621679403778"><span class="hs-identifier">getVal</span></a></a><span> </span><a name="local-6989586621679403781"><a href="#local-6989586621679403781"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-496"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Const"><span class="hs-identifier hs-var">Const</span></a><span> </span><a name="local-6989586621679403782"><a href="#local-6989586621679403782"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679403781"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679403774"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679403782"><span class="hs-identifier hs-var">val</span></a><span>
</span><a name="line-497"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-498"></a><span>    </span><a name="local-6989586621679403779"><a href="#local-6989586621679403779"><span class="hs-identifier">pulledVals</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679403778"><span class="hs-identifier hs-var">getVal</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Node.html#nodeArgs"><span class="hs-identifier hs-var">nodeArgs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679403777"><span class="hs-identifier hs-var">node</span></a><span>
</span><a name="line-499"></a><span>    </span><a name="local-6989586621679403780"><a href="#local-6989586621679403780"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#const_"><span class="hs-identifier hs-var">const_</span></a><span> </span><a href="#local-6989586621679403776"><span class="hs-identifier hs-var">shape</span></a><span>
</span><a name="line-500"></a><span>
</span><a name="line-501"></a><span class="hs-comment">-- | rotateAmount in each direction always lie within (0, dim - 1)</span><span>
</span><a name="line-502"></a><span class="hs-comment">--</span><span>
</span><a name="line-503"></a><span class="hs-identifier">normalizeRotateRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-504"></a><a name="normalizeRotateRules"><a href="HashedExpression.Internal.Normalize.html#normalizeRotateRules"><span class="hs-identifier">normalizeRotateRules</span></a></a><span> </span><a name="local-6989586621679404203"><a href="#local-6989586621679404203"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679404204"><a href="#local-6989586621679404204"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404205"><a href="#local-6989586621679404205"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-505"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679404206"><a href="#local-6989586621679404206"><span class="hs-identifier">shape</span></a></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Rotate"><span class="hs-identifier hs-var">Rotate</span></a><span> </span><a name="local-6989586621679404207"><a href="#local-6989586621679404207"><span class="hs-identifier">amount</span></a></a><span> </span><a name="local-6989586621679404208"><a href="#local-6989586621679404208"><span class="hs-identifier">arg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveInternal"><span class="hs-identifier hs-var">retrieveInternal</span></a><span> </span><a href="#local-6989586621679404205"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404204"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-506"></a><span>        </span><a href="HashedExpression.Internal.Expression.html#rotate"><span class="hs-identifier hs-var">rotate</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">zipWith</span><span> </span><span class="hs-identifier hs-var">mod</span><span> </span><a href="#local-6989586621679404207"><span class="hs-identifier hs-var">amount</span></a><span> </span><a href="#local-6989586621679404206"><span class="hs-identifier hs-var">shape</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404208"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-507"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404205"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span class="hs-comment">-- | Because sometimes we got both Const (-0.0) and Const (0.0) which are different, so we turn them</span><span>
</span><a name="line-510"></a><span class="hs-comment">-- to Const (0.0)</span><span>
</span><a name="line-511"></a><span class="hs-comment">--</span><span>
</span><a name="line-512"></a><span class="hs-identifier">negativeZeroRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-513"></a><a name="negativeZeroRules"><a href="HashedExpression.Internal.Normalize.html#negativeZeroRules"><span class="hs-identifier">negativeZeroRules</span></a></a><span> </span><a name="local-6989586621679404209"><a href="#local-6989586621679404209"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679404210"><a href="#local-6989586621679404210"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404211"><a href="#local-6989586621679404211"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-514"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679404212"><a href="#local-6989586621679404212"><span class="hs-identifier">shape</span></a></a><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Const"><span class="hs-identifier hs-var">Const</span></a><span> </span><a name="local-6989586621679404213"><a href="#local-6989586621679404213"><span class="hs-identifier">val</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveInternal"><span class="hs-identifier hs-var">retrieveInternal</span></a><span> </span><a href="#local-6989586621679404211"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404210"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-515"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404213"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">0.0</span><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="#local-6989586621679404213"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">0.0</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#const_"><span class="hs-identifier hs-var">const_</span></a><span> </span><a href="#local-6989586621679404212"><span class="hs-identifier hs-var">shape</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-516"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404211"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-517"></a><span>
</span><a name="line-518"></a><span class="hs-comment">-- | Piecewise of RealImag -&gt; RealImag of piecewises</span><span>
</span><a name="line-519"></a><span class="hs-comment">-- if a &gt; 2 then x +: y else m +: n --&gt; (if a &gt; 2 then x else m) +: (if a &gt; 2 then y else n)</span><span>
</span><a name="line-520"></a><span class="hs-comment">--</span><span>
</span><a name="line-521"></a><span class="hs-identifier">expandPiecewiseRealImag</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-522"></a><a name="expandPiecewiseRealImag"><a href="HashedExpression.Internal.Normalize.html#expandPiecewiseRealImag"><span class="hs-identifier">expandPiecewiseRealImag</span></a></a><span> </span><a name="local-6989586621679404214"><a href="#local-6989586621679404214"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679404215"><a href="#local-6989586621679404215"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404216"><a href="#local-6989586621679404216"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-523"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Piecewise"><span class="hs-identifier hs-var">Piecewise</span></a><span> </span><a name="local-6989586621679404221"><a href="#local-6989586621679404221"><span class="hs-identifier">marks</span></a></a><span> </span><a name="local-6989586621679404222"><a href="#local-6989586621679404222"><span class="hs-identifier">condition</span></a></a><span> </span><a name="local-6989586621679404223"><a href="#local-6989586621679404223"><span class="hs-identifier">branches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404216"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404215"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-524"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679404224"><a href="#local-6989586621679404224"><span class="hs-identifier">reIms</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679404217"><span class="hs-identifier hs-var">extract</span></a><span> </span><a href="#local-6989586621679404223"><span class="hs-identifier hs-var">branches</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-525"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679404225"><a href="#local-6989586621679404225"><span class="hs-identifier">reIds</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404226"><a href="#local-6989586621679404226"><span class="hs-identifier">imIds</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">unzip</span><span> </span><a href="#local-6989586621679404224"><span class="hs-identifier hs-var">reIms</span></a><span>
</span><a name="line-526"></a><span>            </span><a name="local-6989586621679404227"><a href="#local-6989586621679404227"><span class="hs-identifier">cdt</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404222"><span class="hs-identifier hs-var">condition</span></a><span>
</span><a name="line-527"></a><span>            </span><a name="local-6989586621679404228"><a href="#local-6989586621679404228"><span class="hs-identifier">res</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404225"><span class="hs-identifier hs-var">reIds</span></a><span>
</span><a name="line-528"></a><span>            </span><a name="local-6989586621679404229"><a href="#local-6989586621679404229"><span class="hs-identifier">ims</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404226"><span class="hs-identifier hs-var">imIds</span></a><span>
</span><a name="line-529"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="HashedExpression.Internal.Expression.html#piecewise"><span class="hs-identifier hs-var">piecewise</span></a><span> </span><a href="#local-6989586621679404221"><span class="hs-identifier hs-var">marks</span></a><span> </span><a href="#local-6989586621679404227"><span class="hs-identifier hs-var">cdt</span></a><span> </span><a href="#local-6989586621679404228"><span class="hs-identifier hs-var">res</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2B%3A"><span class="hs-operator hs-var">+:</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#piecewise"><span class="hs-identifier hs-var">piecewise</span></a><span> </span><a href="#local-6989586621679404221"><span class="hs-identifier hs-var">marks</span></a><span> </span><a href="#local-6989586621679404227"><span class="hs-identifier hs-var">cdt</span></a><span> </span><a href="#local-6989586621679404229"><span class="hs-identifier hs-var">ims</span></a><span>
</span><a name="line-530"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404216"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-531"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-532"></a><span>    </span><a name="local-6989586621679404217"><a href="#local-6989586621679404217"><span class="hs-identifier">extract</span></a></a><span> </span><a name="local-6989586621679404218"><a href="#local-6989586621679404218"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-533"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#RealImag"><span class="hs-identifier hs-var">RealImag</span></a><span> </span><a name="local-6989586621679404219"><a href="#local-6989586621679404219"><span class="hs-identifier">re</span></a></a><span> </span><a name="local-6989586621679404220"><a href="#local-6989586621679404220"><span class="hs-identifier">im</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404218"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679404215"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679404219"><span class="hs-identifier hs-var">re</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404220"><span class="hs-identifier hs-var">im</span></a><span class="hs-special">)</span><span>
</span><a name="line-534"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-535"></a><span>
</span><a name="line-536"></a><span class="hs-comment">-- | piecewise marks condition [branch1, branch2, ..] --&gt;</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- branch1 * piecewise marks condition [1, 0, 0, ..] + branch2 * piecewise marks condition [0, 1, 0, ..] + ..</span><span>
</span><a name="line-538"></a><span class="hs-comment">--</span><span>
</span><a name="line-539"></a><span class="hs-identifier">pullOutPiecewiseRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-540"></a><a name="pullOutPiecewiseRules"><a href="HashedExpression.Internal.Normalize.html#pullOutPiecewiseRules"><span class="hs-identifier">pullOutPiecewiseRules</span></a></a><span> </span><a name="local-6989586621679404230"><a href="#local-6989586621679404230"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679404231"><a href="#local-6989586621679404231"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404232"><a href="#local-6989586621679404232"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Piecewise"><span class="hs-identifier hs-var">Piecewise</span></a><span> </span><a name="local-6989586621679404240"><a href="#local-6989586621679404240"><span class="hs-identifier">marks</span></a></a><span> </span><a name="local-6989586621679404241"><a href="#local-6989586621679404241"><span class="hs-identifier">condition</span></a></a><span> </span><a name="local-6989586621679404242"><a href="#local-6989586621679404242"><span class="hs-identifier">branches</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404232"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-542"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404234"><span class="hs-identifier hs-var">et</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="HashedExpression.Internal.Expression.html#C"><span class="hs-identifier hs-var">C</span></a><span>
</span><a name="line-543"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679404233"><span class="hs-identifier hs-var">isAllZeroExceptOne</span></a><span> </span><a href="#local-6989586621679404242"><span class="hs-identifier hs-var">branches</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-544"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679404243"><a href="#local-6989586621679404243"><span class="hs-identifier">branchWithPiecewise</span></a></a><span> </span><a name="local-6989586621679404244"><a href="#local-6989586621679404244"><span class="hs-identifier">idx</span></a></a><span> </span><a name="local-6989586621679404245"><a href="#local-6989586621679404245"><span class="hs-identifier">branch</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-545"></a><span>                </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679404246"><a href="#local-6989586621679404246"><span class="hs-identifier">newPiecewiseBranches</span></a></a><span> </span><span class="hs-comment">-- [1, 0, 0 .. ]</span><span>
</span><a name="line-546"></a><span>                     </span><span class="hs-glyph">=</span><span>
</span><a name="line-547"></a><span>                        </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679404244"><span class="hs-identifier hs-var">idx</span></a><span> </span><a href="#local-6989586621679404237"><span class="hs-identifier hs-var">zero</span></a><span> </span><span class="hs-operator hs-var">++</span><span>
</span><a name="line-548"></a><span>                        </span><span class="hs-special">[</span><a href="#local-6989586621679404236"><span class="hs-identifier hs-var">one</span></a><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679404242"><span class="hs-identifier hs-var">branches</span></a><span> </span><span class="hs-glyph">-</span><span> </span><a href="#local-6989586621679404244"><span class="hs-identifier hs-var">idx</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679404237"><span class="hs-identifier hs-var">zero</span></a><span>
</span><a name="line-549"></a><span>                    </span><a name="local-6989586621679404247"><a href="#local-6989586621679404247"><span class="hs-identifier">allZerosOneOne</span></a></a><span> </span><span class="hs-comment">-- piecewise marks condition [1, 0, 0, ..]</span><span>
</span><a name="line-550"></a><span>                     </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Expression.html#piecewise"><span class="hs-identifier hs-var">piecewise</span></a><span> </span><a href="#local-6989586621679404240"><span class="hs-identifier hs-var">marks</span></a><span> </span><span class="hs-special">(</span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404241"><span class="hs-identifier hs-var">condition</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679404246"><span class="hs-identifier hs-var">newPiecewiseBranches</span></a><span>
</span><a name="line-551"></a><span>                 </span><span class="hs-keyword">in</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404245"><span class="hs-identifier hs-var">branch</span></a><span> </span><span class="hs-operator hs-var">*</span><span> </span><a href="#local-6989586621679404247"><span class="hs-identifier hs-var">allZerosOneOne</span></a><span>
</span><a name="line-552"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="HashedExpression.Internal.Inner.html#sum_"><span class="hs-identifier hs-var">sum_</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679404243"><span class="hs-identifier hs-var">branchWithPiecewise</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679404242"><span class="hs-identifier hs-var">branches</span></a><span>
</span><a name="line-553"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404232"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-554"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-555"></a><span>    </span><a name="local-6989586621679404233"><a href="#local-6989586621679404233"><span class="hs-identifier">isAllZeroExceptOne</span></a></a><span> </span><a name="local-6989586621679404238"><a href="#local-6989586621679404238"><span class="hs-identifier">branches</span></a></a><span>
</span><a name="line-556"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">[</span><a name="local-6989586621679404239"><a href="#local-6989586621679404239"><span class="hs-identifier">shouldBeOne</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="HashedExpression.Internal.Utils.html#isZero"><span class="hs-identifier hs-var">isZero</span></a><span> </span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679404238"><span class="hs-identifier hs-var">branches</span></a><span>
</span><a name="line-557"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Utils.html#isOne"><span class="hs-identifier hs-var">isOne</span></a><span> </span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">mp</span></a><span> </span><a href="#local-6989586621679404239"><span class="hs-identifier hs-var">shouldBeOne</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-558"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-559"></a><span>    </span><a name="local-6989586621679404234"><a href="#local-6989586621679404234"><span class="hs-identifier">et</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveElementType"><span class="hs-identifier hs-var">retrieveElementType</span></a><span> </span><a href="#local-6989586621679404232"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-560"></a><span>    </span><a name="local-6989586621679404235"><a href="#local-6989586621679404235"><span class="hs-identifier">shape</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679404232"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404231"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-561"></a><span>    </span><a name="local-6989586621679404236"><a href="#local-6989586621679404236"><span class="hs-identifier">one</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#const_"><span class="hs-identifier hs-var">const_</span></a><span> </span><a href="#local-6989586621679404235"><span class="hs-identifier hs-var">shape</span></a><span> </span><span class="hs-number">1</span><span>
</span><a name="line-562"></a><span>    </span><a name="local-6989586621679404237"><a href="#local-6989586621679404237"><span class="hs-identifier">zero</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#const_"><span class="hs-identifier hs-var">const_</span></a><span> </span><a href="#local-6989586621679404235"><span class="hs-identifier hs-var">shape</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-563"></a><span>
</span><a name="line-564"></a><span class="hs-comment">-- | (s *. ) twiceReFT(x) + (s *. ) twiceImFT(x) ~~~&gt; (s * size(x) / 2) *. x</span><span>
</span><a name="line-565"></a><span class="hs-comment">--</span><span>
</span><a name="line-566"></a><span class="hs-identifier">twiceReFTAndImFTRules</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="HashedExpression.Internal.Inner.html#Modification"><span class="hs-identifier hs-type">Modification</span></a><span>
</span><a name="line-567"></a><a name="twiceReFTAndImFTRules"><a href="HashedExpression.Internal.Normalize.html#twiceReFTAndImFTRules"><span class="hs-identifier">twiceReFTAndImFTRules</span></a></a><span> </span><a name="local-6989586621679404248"><a href="#local-6989586621679404248"><span class="hs-identifier">exp</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679404249"><a href="#local-6989586621679404249"><span class="hs-identifier">mp</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404250"><a href="#local-6989586621679404250"><span class="hs-identifier">n</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-568"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Sum"><span class="hs-identifier hs-var">Sum</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><a name="local-6989586621679404267"><a href="#local-6989586621679404267"><span class="hs-identifier">sumands</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404250"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-569"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679404268"><a href="#local-6989586621679404268"><span class="hs-identifier">scaleFactor</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404269"><a href="#local-6989586621679404269"><span class="hs-identifier">twiceReFTid</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679404270"><a href="#local-6989586621679404270"><span class="hs-identifier">innerArg</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">firstJust</span><span> </span><a href="#local-6989586621679404251"><span class="hs-identifier hs-var">isTwiceReFT</span></a><span> </span><a href="#local-6989586621679404267"><span class="hs-identifier hs-var">sumands</span></a><span>
</span><a name="line-570"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679404271"><a href="#local-6989586621679404271"><span class="hs-identifier">twiceImFTid</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">find</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679404252"><span class="hs-identifier hs-var">isTwiceImFTof</span></a><span> </span><a href="#local-6989586621679404270"><span class="hs-identifier hs-var">innerArg</span></a><span> </span><a href="#local-6989586621679404268"><span class="hs-identifier hs-var">scaleFactor</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679404267"><span class="hs-identifier hs-var">sumands</span></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-571"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679404272"><a href="#local-6989586621679404272"><span class="hs-identifier">rest</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-572"></a><span>                </span><span class="hs-identifier hs-var">map</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679404276"><a href="#local-6989586621679404276"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679404276"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679404269"><span class="hs-identifier hs-var">twiceReFTid</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679404276"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679404271"><span class="hs-identifier hs-var">twiceImFTid</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-573"></a><span>                </span><a href="#local-6989586621679404267"><span class="hs-identifier hs-var">sumands</span></a><span>
</span><a name="line-574"></a><span>            </span><a name="local-6989586621679404273"><a href="#local-6989586621679404273"><span class="hs-identifier">totalScaleFactor</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-575"></a><span>                </span><a href="#local-6989586621679404268"><span class="hs-identifier hs-var">scaleFactor</span></a><span> </span><span class="hs-operator hs-var">*</span><span>
</span><a name="line-576"></a><span>                </span><span class="hs-identifier hs-var">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Prelude.product</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveShape"><span class="hs-identifier hs-var">retrieveShape</span></a><span> </span><a href="#local-6989586621679404270"><span class="hs-identifier hs-var">innerArg</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span class="hs-special">)</span><span>
</span><a name="line-577"></a><span>            </span><a name="local-6989586621679404274"><a href="#local-6989586621679404274"><span class="hs-identifier">scalar</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#num_"><span class="hs-identifier hs-var">num_</span></a><span> </span><a href="#local-6989586621679404273"><span class="hs-identifier hs-var">totalScaleFactor</span></a><span>
</span><a name="line-578"></a><span>            </span><a name="local-6989586621679404275"><a href="#local-6989586621679404275"><span class="hs-identifier">scaled</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679404274"><span class="hs-identifier hs-var">scalar</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#%2A."><span class="hs-operator hs-var">*.</span></a><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404270"><span class="hs-identifier hs-var">innerArg</span></a><span>
</span><a name="line-579"></a><span>         </span><span class="hs-keyword">in</span><span> </span><a href="HashedExpression.Internal.Inner.html#sum_"><span class="hs-identifier hs-var">sum_</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679404275"><span class="hs-identifier hs-var">scaled</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679404272"><span class="hs-identifier hs-var">rest</span></a><span>
</span><a name="line-580"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="HashedExpression.Internal.Inner.html#just"><span class="hs-identifier hs-var">just</span></a><span> </span><a href="#local-6989586621679404250"><span class="hs-identifier hs-var">n</span></a><span>
</span><a name="line-581"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-582"></a><span>    </span><a name="local-6989586621679404251"><a href="#local-6989586621679404251"><span class="hs-identifier">isTwiceReFT</span></a></a><span> </span><a name="local-6989586621679404253"><a href="#local-6989586621679404253"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-583"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#TwiceReFT"><span class="hs-identifier hs-var">TwiceReFT</span></a><span> </span><a name="local-6989586621679404254"><a href="#local-6989586621679404254"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404253"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404253"><span class="hs-identifier hs-var">nId</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404254"><span class="hs-identifier hs-var">inner</span></a><span class="hs-special">)</span><span>
</span><a name="line-584"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><a name="local-6989586621679404255"><a href="#local-6989586621679404255"><span class="hs-identifier">scalarId</span></a></a><span> </span><a name="local-6989586621679404256"><a href="#local-6989586621679404256"><span class="hs-identifier">scaleeId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404253"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-585"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Const"><span class="hs-identifier hs-var">Const</span></a><span> </span><a name="local-6989586621679404257"><a href="#local-6989586621679404257"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404255"><span class="hs-identifier hs-var">scalarId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-586"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#TwiceReFT"><span class="hs-identifier hs-var">TwiceReFT</span></a><span> </span><a name="local-6989586621679404258"><a href="#local-6989586621679404258"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404256"><span class="hs-identifier hs-var">scaleeId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679404257"><span class="hs-identifier hs-var">val</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404253"><span class="hs-identifier hs-var">nId</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404258"><span class="hs-identifier hs-var">inner</span></a><span class="hs-special">)</span><span>
</span><a name="line-587"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-588"></a><span>    </span><a name="local-6989586621679404252"><a href="#local-6989586621679404252"><span class="hs-identifier">isTwiceImFTof</span></a></a><span> </span><a name="local-6989586621679404259"><a href="#local-6989586621679404259"><span class="hs-identifier">innerArg</span></a></a><span> </span><a name="local-6989586621679404260"><a href="#local-6989586621679404260"><span class="hs-identifier">scaleFactor</span></a></a><span> </span><a name="local-6989586621679404261"><a href="#local-6989586621679404261"><span class="hs-identifier">nId</span></a></a><span>
</span><a name="line-589"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#TwiceImFT"><span class="hs-identifier hs-var">TwiceImFT</span></a><span> </span><a name="local-6989586621679404262"><a href="#local-6989586621679404262"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404261"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-590"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404260"><span class="hs-identifier hs-var">scaleFactor</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-591"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404262"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679404259"><span class="hs-identifier hs-var">innerArg</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-592"></a><span>        </span><span class="hs-glyph">|</span><span> </span><a href="HashedExpression.Internal.Expression.html#Scale"><span class="hs-identifier hs-var">Scale</span></a><span> </span><a href="HashedExpression.Internal.Expression.html#R"><span class="hs-identifier hs-var">R</span></a><span> </span><a name="local-6989586621679404263"><a href="#local-6989586621679404263"><span class="hs-identifier">scalarId</span></a></a><span> </span><a name="local-6989586621679404264"><a href="#local-6989586621679404264"><span class="hs-identifier">scaleeId</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404261"><span class="hs-identifier hs-var">nId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-593"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#Const"><span class="hs-identifier hs-var">Const</span></a><span> </span><a name="local-6989586621679404265"><a href="#local-6989586621679404265"><span class="hs-identifier">val</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404263"><span class="hs-identifier hs-var">scalarId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-594"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404265"><span class="hs-identifier hs-var">val</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679404260"><span class="hs-identifier hs-var">scaleFactor</span></a><span>
</span><a name="line-595"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="HashedExpression.Internal.Expression.html#TwiceImFT"><span class="hs-identifier hs-var">TwiceImFT</span></a><span> </span><a name="local-6989586621679404266"><a href="#local-6989586621679404266"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="HashedExpression.Internal.Node.html#retrieveNode"><span class="hs-identifier hs-var">retrieveNode</span></a><span> </span><a href="#local-6989586621679404264"><span class="hs-identifier hs-var">scaleeId</span></a><span> </span><a href="#local-6989586621679404249"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-596"></a><span>        </span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679404266"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679404259"><span class="hs-identifier hs-var">innerArg</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-597"></a><span>        </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-598"></a></pre></body></html>